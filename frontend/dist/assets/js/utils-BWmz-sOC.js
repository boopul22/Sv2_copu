var i=(t,e,r)=>new Promise((s,o)=>{var a=c=>{try{l(r.next(c))}catch(u){o(u)}},n=c=>{try{l(r.throw(c))}catch(u){o(u)}},l=c=>c.done?s(c.value):Promise.resolve(c.value).then(a,n);l((r=r.apply(t,e)).next())});import{s as j}from"./vendor-Dxve-ft9.js";import{c as M}from"./supabase-vendor-DJ5DSPXj.js";const A=void 0,O=void 0;throw new Error("Missing Supabase environment variables. Check your .env file and ENVIRONMENT_VARIABLES.md");const h=M(A,O,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0},db:{schema:"public"},global:{headers:{"X-Client-Info":"sayari-blog@1.0.0"}}}),R=M(A,O,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1},db:{schema:"public"},global:{headers:{"X-Client-Info":"sayari-blog-public@1.0.0"}}}),Ce=(t,e=150)=>{if(!t)return"";const r=t.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/\s+/g," ").trim();if(r.length<=e)return r;const s=r.substring(0,e),o=s.lastIndexOf(" ");return o>e*.8?s.substring(0,o)+"...":s+"..."},N=t=>t?(t.startsWith("http://")||t.startsWith("https://"),t):null,Te=(t,e=null)=>{if(e)return N(e);if(!t)return null;const r=t.match(/<img[^>]+src="([^"]*)"[^>]*>/i);return r?N(r[1]):null},Ue=t=>{if(!t)return"";const e=new Date(t),s=Math.abs(new Date-e),o=Math.ceil(s/(1e3*60*60*24));return o===1?"Yesterday":o<7?`${o} days ago`:o<30?`${Math.ceil(o/7)} weeks ago`:e.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},Re=(t,e)=>{let r;return function(...o){const a=()=>{clearTimeout(r),t(...o)};clearTimeout(r),r=setTimeout(a,e)}},W=!!(window.location.hostname==="localhost"||window.location.hostname==="[::1]"||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ke(t){if("serviceWorker"in navigator){if(new URL("/",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",()=>{const r="/sw.js";W?(z(r,t),navigator.serviceWorker.ready.then(()=>{})):D(r,t)})}}function D(t,e){navigator.serviceWorker.register(t).then(r=>{r.onupdatefound=()=>{const s=r.installing;s!=null&&(s.onstatechange=()=>{s.state==="installed"&&(navigator.serviceWorker.controller?e&&e.onUpdate&&e.onUpdate(r):e&&e.onSuccess&&e.onSuccess(r))})}}).catch(r=>{})}function z(t,e){fetch(t,{headers:{"Service-Worker":"script"}}).then(r=>{const s=r.headers.get("content-type");r.status===404||s!=null&&s.indexOf("javascript")===-1?navigator.serviceWorker.ready.then(o=>{o.unregister().then(()=>{window.location.reload()})}):D(t,e)}).catch(()=>{})}class K{constructor(){this.metrics={},this.observers=[],this.init()}init(){this.trackLCP(),this.trackFID(),this.trackCLS(),this.trackFCP(),this.trackTTFB(),this.trackNavigationTiming(),this.trackResourceTiming()}trackLCP(){if("PerformanceObserver"in window){const e=new PerformanceObserver(r=>{const s=r.getEntries(),o=s[s.length-1];this.metrics.lcp={value:o.startTime,element:o.element,timestamp:Date.now()},this.reportMetric("LCP",o.startTime)});e.observe({entryTypes:["largest-contentful-paint"]}),this.observers.push(e)}}trackFID(){if("PerformanceObserver"in window){const e=new PerformanceObserver(r=>{r.getEntries().forEach(o=>{this.metrics.fid={value:o.processingStart-o.startTime,timestamp:Date.now()},this.reportMetric("FID",o.processingStart-o.startTime)})});e.observe({entryTypes:["first-input"]}),this.observers.push(e)}}trackCLS(){if("PerformanceObserver"in window){let e=0;const r=new PerformanceObserver(s=>{s.getEntries().forEach(a=>{a.hadRecentInput||(e+=a.value)}),this.metrics.cls={value:e,timestamp:Date.now()},this.reportMetric("CLS",e)});r.observe({entryTypes:["layout-shift"]}),this.observers.push(r)}}trackFCP(){if("PerformanceObserver"in window){const e=new PerformanceObserver(r=>{r.getEntries().forEach(o=>{o.name==="first-contentful-paint"&&(this.metrics.fcp={value:o.startTime,timestamp:Date.now()},this.reportMetric("FCP",o.startTime))})});e.observe({entryTypes:["paint"]}),this.observers.push(e)}}trackTTFB(){if("performance"in window&&"getEntriesByType"in performance){const e=performance.getEntriesByType("navigation");if(e.length>0){const r=e[0],s=r.responseStart-r.requestStart;this.metrics.ttfb={value:s,timestamp:Date.now()},this.reportMetric("TTFB",s)}}}trackNavigationTiming(){if("performance"in window&&"getEntriesByType"in performance){const e=performance.getEntriesByType("navigation");if(e.length>0){const r=e[0];this.metrics.navigation={domContentLoaded:r.domContentLoadedEventEnd-r.domContentLoadedEventStart,loadComplete:r.loadEventEnd-r.loadEventStart,domInteractive:r.domInteractive-r.navigationStart,timestamp:Date.now()}}}}trackResourceTiming(){if("PerformanceObserver"in window){const e=new PerformanceObserver(r=>{r.getEntries().forEach(o=>{o.initiatorType==="img"&&this.trackImageLoad(o)})});e.observe({entryTypes:["resource"]}),this.observers.push(e)}}trackImageLoad(e){const r=e.responseEnd-e.startTime;this.metrics.images||(this.metrics.images=[]),this.metrics.images.push({url:e.name,loadTime:r,size:e.transferSize,timestamp:Date.now()}),r>1e3}reportMetric(e,r){window.gtag&&window.gtag("event","web_vitals",{event_category:"Performance",event_label:e,value:Math.round(r)})}getMetrics(){return this.metrics}getPerformanceScore(){const{lcp:e,fid:r,cls:s,fcp:o}=this.metrics;let a=100;return e&&(e.value>4e3?a-=30:e.value>2500&&(a-=15)),r&&(r.value>300?a-=25:r.value>100&&(a-=10)),s&&(s.value>.25?a-=25:s.value>.1&&(a-=10)),o&&(o.value>3e3?a-=20:o.value>1800&&(a-=10)),Math.max(0,a)}disconnect(){this.observers.forEach(e=>e.disconnect()),this.observers=[]}}const _e=()=>{if(typeof window!="undefined"){const t=new K;return window.addEventListener("load",()=>{setTimeout(()=>{const e=t.getPerformanceScore()},5e3)}),t}return null};let m={posts:null,authors:null,categories:null,tags:null};function k(t){return i(this,null,function*(){try{const e=yield fetch(`/data/static/${t}`);if(!e.ok)throw new Error(`Failed to load ${t}: ${e.status}`);return yield e.json()}catch(e){return null}})}function T(){return i(this,null,function*(){if(m.posts||(m.posts=yield k("posts.json")),m.posts)return m.posts;const{data:t,error:e}=yield R.from("posts").select(`
      id,
      title,
      slug,
      content,
      excerpt,
      author_id,
      published_at,
      status,
      featured_image_url,
      authors:author_id (
        id,
        username,
        display_name,
        bio
      )
    `).eq("status","published").order("published_at",{ascending:!1});if(e)throw new Error(`Failed to fetch posts: ${e.message}`);return t||[]})}function Le(t){return i(this,null,function*(){return(yield T()).find(r=>r.slug===t)||null})}function Fe(t=0,e=10,r=""){return i(this,null,function*(){const s=yield T();let o=s;if(r&&r.trim()){const c=r.toLowerCase();o=s.filter(u=>{var d,g;return u.title.toLowerCase().includes(c)||((d=u.excerpt)==null?void 0:d.toLowerCase().includes(c))||((g=u.content)==null?void 0:g.toLowerCase().includes(c))})}const a=t*e,n=a+e;return{posts:o.slice(a,n),hasMore:n<o.length,total:o.length}})}function G(){return i(this,null,function*(){if(m.authors||(m.authors=yield k("authors.json")),m.authors)return m.authors;const{data:t,error:e}=yield R.from("users").select("id, user_login, display_name, user_registered").order("display_name");if(e)throw new Error(`Failed to fetch authors: ${e.message}`);return t||[]})}function $e(t){return i(this,null,function*(){return(yield G()).find(r=>r.username===t)||null})}function Ne(t,e=""){return i(this,null,function*(){let s=(yield T()).filter(o=>o.author_id===t);if(e&&e.trim()){const o=e.toLowerCase();s=s.filter(a=>{var n,l;return a.title.toLowerCase().includes(o)||((n=a.excerpt)==null?void 0:n.toLowerCase().includes(o))||((l=a.content)==null?void 0:l.toLowerCase().includes(o))})}return s})}function Y(){return i(this,null,function*(){if(m.categories||(m.categories=yield k("categories.json")),m.categories)return m.categories;const{data:t,error:e}=yield R.from("categories").select("id, name, slug, description").order("name");if(e)throw new Error(`Failed to fetch categories: ${e.message}`);return t||[]})}function Me(t){return i(this,null,function*(){return(yield Y()).find(r=>r.slug===t)||null})}function Ae(t,e=""){return i(this,null,function*(){let s=(yield T()).filter(o=>o.categories&&o.categories.some(a=>a.id===t));if(e&&e.trim()){const o=e.toLowerCase();s=s.filter(a=>{var n,l;return a.title.toLowerCase().includes(o)||((n=a.excerpt)==null?void 0:n.toLowerCase().includes(o))||((l=a.content)==null?void 0:l.toLowerCase().includes(o))})}return s})}function J(){return i(this,null,function*(){if(m.tags||(m.tags=yield k("tags.json")),m.tags)return m.tags;const{data:t,error:e}=yield R.from("tags").select("id, name, slug, description").order("name");if(e)throw new Error(`Failed to fetch tags: ${e.message}`);return t||[]})}function Oe(t){return i(this,null,function*(){return(yield J()).find(r=>r.slug===t)||null})}function De(t,e=""){return i(this,null,function*(){let s=(yield T()).filter(o=>o.tags&&o.tags.some(a=>a.id===t));if(e&&e.trim()){const o=e.toLowerCase();s=s.filter(a=>{var n,l;return a.title.toLowerCase().includes(o)||((n=a.excerpt)==null?void 0:n.toLowerCase().includes(o))||((l=a.content)==null?void 0:l.toLowerCase().includes(o))})}return s})}class I{constructor(e={}){this.config=e}upload(s){return i(this,arguments,function*(e,r={}){throw new Error("upload() method must be implemented by storage provider")})}delete(e){return i(this,null,function*(){throw new Error("delete() method must be implemented by storage provider")})}getPublicUrl(e){throw new Error("getPublicUrl() method must be implemented by storage provider")}list(){return i(this,arguments,function*(e={}){throw new Error("list() method must be implemented by storage provider")})}getMetadata(e){return i(this,null,function*(){throw new Error("getMetadata() method must be implemented by storage provider")})}isConfigured(){throw new Error("isConfigured() method must be implemented by storage provider")}getProviderName(){throw new Error("getProviderName() method must be implemented by storage provider")}validateFile(e,r={}){const s=[];if(!e)return s.push("No file provided"),{valid:!1,errors:s};e.type.startsWith("image/")||s.push("File must be an image");const o=r.maxSize||5*1024*1024;return e.size>o&&s.push(`File size must be less than ${Math.round(o/1024/1024)}MB`),{valid:s.length===0,errors:s}}generateUniqueFilename(e){const r=Date.now(),s=Math.random().toString(36).substring(2,8),o=e.split(".").pop(),a=e.split(".").slice(0,-1).join(".").toLowerCase().replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,20);return`${r}-${s}-${a}.${o}`}}class H extends I{constructor(e={}){super(e),this.bucketName=e.bucketName||"images"}upload(s){return i(this,arguments,function*(e,r={}){try{const o=this.validateFile(e,r);if(!o.valid)throw new Error(o.errors.join(", "));const a=this.generateUniqueFilename(e.name);r.onProgress&&r.onProgress(10);const{data:n,error:l}=yield h.storage.from(this.bucketName).upload(a,e,{contentType:e.type,upsert:!1});if(l)throw new Error(`Upload failed: ${l.message}`);r.onProgress&&r.onProgress(90);const{data:{publicUrl:c}}=h.storage.from(this.bucketName).getPublicUrl(a);return r.onProgress&&r.onProgress(100),{success:!0,url:c,filename:a,path:n.path,provider:"supabase"}}catch(o){return{success:!1,error:o.message,provider:"supabase"}}})}delete(e){return i(this,null,function*(){try{if(!e)throw new Error("No file identifier provided");let r=e;e.includes(`/storage/v1/object/public/${this.bucketName}/`)&&(r=e.split(`/${this.bucketName}/`).pop());const{error:s}=yield h.storage.from(this.bucketName).remove([r]);if(s)throw new Error(`Delete failed: ${s.message}`);return{success:!0,message:"Image deleted successfully",provider:"supabase"}}catch(r){return{success:!1,error:r.message,provider:"supabase"}}})}getPublicUrl(e){if(!e||e.startsWith("http"))return e;const r=e.startsWith("/")?e.slice(1):e,{data:{publicUrl:s}}=h.storage.from(this.bucketName).getPublicUrl(r);return s}list(){return i(this,arguments,function*(e={}){try{const{limit:r=100,offset:s=0}=e,{data:o,error:a}=yield h.storage.from(this.bucketName).list("",{limit:r,offset:s,sortBy:{column:"created_at",order:"desc"}});if(a)throw new Error(`Failed to list images: ${a.message}`);return{success:!0,files:o||[],provider:"supabase"}}catch(r){return{success:!1,error:r.message,files:[],provider:"supabase"}}})}getMetadata(e){return i(this,null,function*(){try{if(!e)throw new Error("No file identifier provided");let r=e;e.includes(`/storage/v1/object/public/${this.bucketName}/`)&&(r=e.split(`/${this.bucketName}/`).pop());const{data:s,error:o}=yield h.storage.from(this.bucketName).list("",{search:r});if(o)throw new Error(`Failed to get metadata: ${o.message}`);const a=s.find(n=>n.name===r);if(!a)throw new Error("Image not found");return{success:!0,metadata:a,provider:"supabase"}}catch(r){return{success:!1,error:r.message,metadata:null,provider:"supabase"}}})}isConfigured(){try{return!1}catch(e){return!1}}getProviderName(){return"supabase"}}function X(t,e){return i(this,null,function*(){try{const r=yield fetch("/api/r2/presigned-upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:t,contentType:e})});if(!r.ok)throw new Error(`Failed to get presigned URL: ${r.statusText}`);return yield r.json()}catch(r){throw r}})}function Z(s,o){return i(this,arguments,function*(t,e,r={}){try{const{onProgress:a}=r;a&&a(20);const n=yield fetch(t,{method:"PUT",body:e,headers:{"Content-Type":e.type}});if(a&&a(90),!n.ok)throw new Error(`Upload failed: ${n.statusText}`);return a&&a(100),{success:!0,message:"Upload completed successfully"}}catch(a){return{success:!1,error:a.message}}})}function Q(t){return i(this,null,function*(){try{const e=yield fetch("/api/r2/delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:t})});if(!e.ok)throw new Error(`Delete failed: ${e.statusText}`);return yield e.json()}catch(e){return{success:!1,error:e.message}}})}function ee(){return i(this,arguments,function*(t={}){try{const e=new URLSearchParams;t.limit&&e.set("limit",t.limit),t.offset&&e.set("offset",t.offset);const r=yield fetch(`/api/r2/list?${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`List failed: ${r.statusText}`);return yield r.json()}catch(e){return{success:!1,error:e.message,files:[]}}})}function re(t){return i(this,null,function*(){try{const e=yield fetch(`/api/r2/metadata?filename=${encodeURIComponent(t)}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Metadata request failed: ${e.statusText}`);return yield e.json()}catch(e){return{success:!1,error:e.message,metadata:null}}})}class te extends I{constructor(e={}){super(e),this.accountId=e.accountId||void 0,this.accessKeyId=e.accessKeyId||void 0,this.secretAccessKey=e.secretAccessKey||void 0,this.bucketName=e.bucketName||void 0||"blog-images",this.publicUrl=e.publicUrl||void 0,this.endpoint=e.endpoint||void 0}upload(s){return i(this,arguments,function*(e,r={}){try{const o=this.validateFile(e,r);if(!o.valid)throw new Error(o.errors.join(", "));const a=this.generateUniqueFilename(e.name);r.onProgress&&r.onProgress(10);const n=yield X(a,e.type);if(!n.success)throw new Error(n.error||"Failed to get presigned URL");r.onProgress&&r.onProgress(30);const l=yield Z(n.url,e,{onProgress:u=>{const d=30+u*.7;r.onProgress&&r.onProgress(Math.round(d))}});if(!l.success)throw new Error(l.error||"Upload failed");return{success:!0,url:this.getPublicUrl(a),filename:a,path:a,provider:"cloudflare-r2"}}catch(o){return{success:!1,error:o.message,provider:"cloudflare-r2"}}})}delete(e){return i(this,null,function*(){try{if(!e)throw new Error("No file identifier provided");let r=e;e.includes(this.publicUrl)&&(r=e.replace(`${this.publicUrl}/`,""));const s=yield Q(r);return{success:s.success,message:s.success?"Image deleted successfully":s.error,error:s.success?void 0:s.error,provider:"cloudflare-r2"}}catch(r){return{success:!1,error:r.message,provider:"cloudflare-r2"}}})}getPublicUrl(e){if(!e||e.startsWith("http"))return e;const r=e.startsWith("/")?e.slice(1):e;return`${this.publicUrl}/${r}`}list(){return i(this,arguments,function*(e={}){try{const r=yield ee(e);return{success:r.success,files:r.files||[],error:r.success?void 0:r.error,provider:"cloudflare-r2"}}catch(r){return{success:!1,error:r.message,files:[],provider:"cloudflare-r2"}}})}getMetadata(e){return i(this,null,function*(){try{if(!e)throw new Error("No file identifier provided");let r=e;e.includes(this.publicUrl)&&(r=e.replace(`${this.publicUrl}/`,""));const s=yield re(r);return{success:s.success,metadata:s.metadata,error:s.success?void 0:s.error,provider:"cloudflare-r2"}}catch(r){return{success:!1,error:r.message,metadata:null,provider:"cloudflare-r2"}}})}isConfigured(){return!!(this.accountId&&this.accessKeyId&&this.secretAccessKey&&this.bucketName&&this.publicUrl&&this.endpoint)}getProviderName(){return"cloudflare-r2"}}const se={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSG_MODE:"true",SSR:!1},w={SUPABASE:"supabase",CLOUDFLARE_R2:"cloudflare-r2"};class F{constructor(){this.providers=new Map,this.currentProvider=null,this.fallbackProvider=null,this.initializeProviders(),this.setCurrentProvider()}initializeProviders(){const e=new H({bucketName:"images"});this.providers.set(w.SUPABASE,e);const r=new te;this.providers.set(w.CLOUDFLARE_R2,r)}setCurrentProvider(){const e=w.SUPABASE;this.providers.has(e)?this.providers.get(e).isConfigured()?this.currentProvider=e:this.setFallbackProvider(e):this.setFallbackProvider(),this.currentProvider||(this.currentProvider=this.fallbackProvider,this.currentProvider)}setFallbackProvider(e=null){for(const[r,s]of this.providers)if(r!==e&&s.isConfigured()){this.fallbackProvider=r;break}!this.fallbackProvider&&this.providers.has(w.SUPABASE)&&this.providers.get(w.SUPABASE).isConfigured()&&(this.fallbackProvider=w.SUPABASE)}getCurrentProvider(){return this.currentProvider?this.providers.get(this.currentProvider):null}getProvider(e){return this.providers.get(e)||null}switchProvider(e){return!this.providers.has(e)||!this.providers.get(e).isConfigured()?!1:(this.currentProvider=e,!0)}getConfigurationStatus(){const e={current:this.currentProvider,fallback:this.fallbackProvider,providers:{}};for(const[r,s]of this.providers)e.providers[r]={configured:s.isConfigured(),name:s.getProviderName()};return e}validateConfiguration(){const e=[],r=[],s=Array.from(this.providers.entries()).filter(([o,a])=>a.isConfigured());if(s.length===0&&e.push("No storage providers are properly configured"),!this.currentProvider)e.push("No current storage provider is set");else{const o=this.getCurrentProvider();(!o||!o.isConfigured())&&e.push(`Current provider '${this.currentProvider}' is not properly configured`)}return!this.fallbackProvider&&s.length>1&&r.push("No fallback provider is available"),{valid:e.length===0,errors:e,warnings:r,configuredProviders:s.length,totalProviders:this.providers.size}}static getRequiredEnvironmentVariables(){return{[w.SUPABASE]:["VITE_SUPABASE_URL","VITE_SUPABASE_ANON_KEY"],[w.CLOUDFLARE_R2]:["VITE_CLOUDFLARE_ACCOUNT_ID","VITE_CLOUDFLARE_R2_ACCESS_KEY_ID","VITE_CLOUDFLARE_R2_SECRET_ACCESS_KEY","VITE_CLOUDFLARE_R2_BUCKET_NAME","VITE_CLOUDFLARE_R2_PUBLIC_URL","VITE_CLOUDFLARE_R2_ENDPOINT"],general:["VITE_STORAGE_PROVIDER"]}}static checkMissingEnvironmentVariables(){const e=F.getRequiredEnvironmentVariables(),r={};for(const[s,o]of Object.entries(e))r[s]=o.filter(a=>!se[a]);return r}}const b=new F;function P(){return b.getCurrentProvider()}function oe(){return b.getConfigurationStatus()}function ae(){return b.validateConfiguration()}function ie(r){return i(this,arguments,function*(t,e={}){const s=P();if(!s)return{success:!1,error:"No storage provider is configured",provider:"none"};try{const o=yield s.upload(t,e);return o.provider||(o.provider=s.getProviderName()),o}catch(o){return{success:!1,error:o.message,provider:s.getProviderName()}}})}function ne(t){return i(this,null,function*(){const e=P();if(!e)return{success:!1,error:"No storage provider is configured",provider:"none"};try{const r=yield e.delete(t);return r.provider||(r.provider=e.getProviderName()),r}catch(r){return{success:!1,error:r.message,provider:e.getProviderName()}}})}function ce(t){const e=P();if(!e)return t;try{return e.getPublicUrl(t)}catch(r){return t}}function le(){return i(this,arguments,function*(t={}){const e=P();if(!e)return{success:!1,error:"No storage provider is configured",files:[],provider:"none"};try{const r=yield e.list(t);return r.provider||(r.provider=e.getProviderName()),r}catch(r){return{success:!1,error:r.message,files:[],provider:e.getProviderName()}}})}function ue(t){return i(this,null,function*(){const e=P();if(!e)return{success:!1,error:"No storage provider is configured",metadata:null,provider:"none"};try{const r=yield e.getMetadata(t);return r.provider||(r.provider=e.getProviderName()),r}catch(r){return{success:!1,error:r.message,metadata:null,provider:e.getProviderName()}}})}function Ie(){const t=P();return t?t.getProviderName():null}function de(){return oe()}function ge(){return ae()}const xe=(r,...s)=>i(null,[r,...s],function*(t,e={}){const{maxWidth:o=1200,maxHeight:a=800,quality:n=.8,format:l="image/jpeg"}=e;return new Promise((c,u)=>{const d=document.createElement("canvas"),g=d.getContext("2d"),p=new Image;p.onload=()=>{let{width:f,height:v}=p;f>o&&(v=v*o/f,f=o),v>a&&(f=f*a/v,v=a),d.width=f,d.height=v,g.drawImage(p,0,0,f,v),d.toBlob(E=>{if(E){const S=new File([E],t.name,{type:l,lastModified:Date.now()});c(S)}else u(new Error("Failed to compress image"))},l,n)},p.onerror=()=>{u(new Error("Failed to load image"))},p.src=URL.createObjectURL(t)})}),fe={अ:"a",आ:"aa",इ:"i",ई:"ii",उ:"u",ऊ:"uu",ए:"e",ऐ:"ai",ओ:"o",औ:"au",क:"ka",ख:"kha",ग:"ga",घ:"gha",ङ:"nga",च:"cha",छ:"chha",ज:"ja",झ:"jha",ञ:"nya",ट:"ta",ठ:"tha",ड:"da",ढ:"dha",ण:"na",त:"ta",थ:"tha",द:"da",ध:"dha",न:"na",प:"pa",फ:"pha",ब:"ba",भ:"bha",म:"ma",य:"ya",र:"ra",ल:"la",व:"va",श:"sha",ष:"sha",स:"sa",ह:"ha",क्ष:"ksha",त्र:"tra",ज्ञ:"gya","ं":"n","ः":"h","्":"","ा":"aa","ि":"i","ी":"ii","ु":"u","ू":"uu","े":"e","ै":"ai","ो":"o","ौ":"au"},me=t=>{if(!t)return"";let e=t;return Object.entries(fe).forEach(([r,s])=>{const o=new RegExp(r,"g");e=e.replace(o,s)}),e},Ve=t=>{if(!t)return"";const e=me(t),r=j(e,{lower:!0,strict:!0,remove:/[*+~.()'"!:@]/g});return r?r.substring(0,100):`post-${Date.now()}`},pe=(t,e=null)=>i(null,null,function*(){if(!t)return!1;try{let r=h.from("posts").select("id").eq("slug",t);e&&(r=r.neq("id",e));const{data:s,error:o}=yield r;return o?!1:!s||s.length===0}catch(r){return!1}}),x=(t,e=null)=>i(null,null,function*(){let r=t,s=1;for(;!(yield pe(r,e));)if(r=`${t}-${s}`,s++,s>100){r=`${t}-${Date.now()}`;break}return r}),V=t=>t?t.length<3?{isValid:!1,message:"Slug must be at least 3 characters long"}:t.length>100?{isValid:!1,message:"Slug must be less than 100 characters"}:/^[a-z0-9-]+$/.test(t)?t.startsWith("-")||t.endsWith("-")?{isValid:!1,message:"Slug cannot start or end with a hyphen"}:t.includes("--")?{isValid:!1,message:"Slug cannot contain consecutive hyphens"}:["admin","api","www","mail","ftp","localhost","test","staging","dev","development","prod","production","blog","post","page","category","tag","author","search"].includes(t)?{isValid:!1,message:"This slug is reserved and cannot be used"}:{isValid:!0,message:""}:{isValid:!1,message:"Slug can only contain lowercase letters, numbers, and hyphens"}:{isValid:!1,message:"Slug is required"},Be=t=>i(null,null,function*(){try{if(!t.title)throw new Error("Title is required");const e=V(t.slug);if(!e.isValid)throw new Error(e.message);const r=yield x(t.slug),{data:{user:s}}=yield h.auth.getUser();if(!s)throw new Error("You must be logged in to create posts");const o={title:t.title.trim(),slug:r,content:t.content||"",excerpt:t.excerpt||"",status:t.status||"draft",featured_image_url:t.featured_image_url||null,meta_title:t.meta_title||null,meta_description:t.meta_description||null,author_id:s.id,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};o.status==="published"&&(o.published_at=t.published_at||new Date().toISOString());const{data:a,error:n}=yield h.from("posts").insert([o]).select().single();if(n)throw new Error(`Failed to create post: ${n.message}`);return a}catch(e){throw e}}),qe=(t,e)=>i(null,null,function*(){try{if(!t)throw new Error("Post ID is required");if(!e.title)throw new Error("Title is required");if(e.slug){const a=V(e.slug);if(!a.isValid)throw new Error(a.message);const n=yield x(e.slug,t);e.slug=n}const r={title:e.title.trim(),content:e.content||"",excerpt:e.excerpt||"",status:e.status||"draft",featured_image_url:e.featured_image_url||null,meta_title:e.meta_title||null,meta_description:e.meta_description||null,updated_at:new Date().toISOString()};if(e.slug&&(r.slug=e.slug),r.status==="published"&&e.published_at)r.published_at=e.published_at;else if(r.status==="published"){const{data:a}=yield h.from("posts").select("published_at").eq("id",t).single();a!=null&&a.published_at||(r.published_at=new Date().toISOString())}const{data:s,error:o}=yield h.from("posts").update(r).eq("id",t).select().single();if(o)throw new Error(`Failed to update post: ${o.message}`);return s}catch(r){throw r}}),je=t=>i(null,null,function*(){try{if(!t)throw new Error("Post ID is required");const{error:e}=yield h.from("posts").delete().eq("id",t);if(e)throw new Error(`Failed to delete post: ${e.message}`);return!0}catch(e){throw e}}),We=(...e)=>i(null,[...e],function*(t={}){try{const{page:r=0,limit:s=10,status:o=null,search:a="",orderBy:n="updated_at",orderDirection:l="desc"}=t;let c=h.from("posts").select("id, title, slug, status, published_at, created_at, updated_at",{count:"exact"});o&&o!=="all"&&(c=c.eq("status",o)),a&&a.trim()&&(c=c.ilike("title",`%${a.trim()}%`)),c=c.order(n,{ascending:l==="asc"});const u=r*s,d=u+s-1;c=c.range(u,d);const{data:g,error:p,count:f}=yield c;if(p)throw new Error(`Failed to fetch posts: ${p.message}`);return{posts:g||[],total:f||0,page:r,limit:s,hasMore:g&&g.length===s}}catch(r){throw r}}),ze=(t,e)=>i(null,null,function*(){try{if(!t||t.length===0)throw new Error("Post IDs are required");if(!["draft","published","private"].includes(e))throw new Error("Invalid status");const r={status:e,updated_at:new Date().toISOString()};e==="published"&&(r.published_at=new Date().toISOString());const{data:s,error:o}=yield h.from("posts").update(r).in("id",t).select("id");if(o)throw new Error(`Failed to update posts: ${o.message}`);return s?s.length:0}catch(r){throw r}});class he{constructor(){this.testResults=[]}runValidationTests(){return i(this,arguments,function*(e={}){const{includeUploadTest:r=!1,testImageUrl:s=null}=e;this.testResults=[];let o=0,a=0;a++;const n=yield this.testConfiguration();n.passed&&o++,this.testResults.push(n),a++;const l=yield this.testProviderAvailability();l.passed&&o++,this.testResults.push(l),a++;const c=yield this.testUrlGeneration();c.passed&&o++,this.testResults.push(c),a++;const u=yield this.testListFunctionality();if(u.passed&&o++,this.testResults.push(u),s){a++;const g=yield this.testMetadataFunctionality(s);g.passed&&o++,this.testResults.push(g)}if(r){a++;const g=yield this.testUploadDeleteFunctionality();g.passed&&o++,this.testResults.push(g)}return{success:o===a,passedTests:o,totalTests:a,passRate:Math.round(o/a*100),results:this.testResults,timestamp:new Date().toISOString()}})}testConfiguration(){return i(this,null,function*(){try{const e=de(),r=ge(),s=r.valid&&e.current!==null;return{name:"Configuration Test",passed:s,details:{currentProvider:e.current,configuredProviders:Object.keys(e.providers).filter(o=>e.providers[o].configured),validationErrors:r.errors,validationWarnings:r.warnings},message:s?"Storage configuration is valid":"Storage configuration has issues"}}catch(e){return{name:"Configuration Test",passed:!1,error:e.message,message:"Configuration test failed"}}})}testProviderAvailability(){return i(this,null,function*(){try{const e=P(),r=e!==null&&e.isConfigured();return{name:"Provider Availability Test",passed:r,details:{providerName:e?e.getProviderName():"none",isConfigured:e?e.isConfigured():!1},message:r?"Storage provider is available and configured":"Storage provider is not available"}}catch(e){return{name:"Provider Availability Test",passed:!1,error:e.message,message:"Provider availability test failed"}}})}testUrlGeneration(){return i(this,null,function*(){try{const e="test-image.jpg",r=ce(e),s=typeof r=="string"&&r.length>0&&r!==e;return{name:"URL Generation Test",passed:s,details:{testFilename:e,generatedUrl:r,urlLength:r?r.length:0},message:s?"URL generation works correctly":"URL generation failed"}}catch(e){return{name:"URL Generation Test",passed:!1,error:e.message,message:"URL generation test failed"}}})}testListFunctionality(){return i(this,null,function*(){try{const e=yield le({limit:5}),r=e.success&&Array.isArray(e.files);return{name:"List Functionality Test",passed:r,details:{success:e.success,fileCount:e.files?e.files.length:0,error:e.error},message:r?"List functionality works correctly":"List functionality failed"}}catch(e){return{name:"List Functionality Test",passed:!1,error:e.message,message:"List functionality test failed"}}})}testMetadataFunctionality(e){return i(this,null,function*(){try{const r=yield ue(e),s=r.success&&r.metadata!==null;return{name:"Metadata Functionality Test",passed:s,details:{testImageUrl:e,success:r.success,hasMetadata:r.metadata!==null,error:r.error},message:s?"Metadata functionality works correctly":"Metadata functionality failed"}}catch(r){return{name:"Metadata Functionality Test",passed:!1,error:r.message,message:"Metadata functionality test failed"}}})}testUploadDeleteFunctionality(){return i(this,null,function*(){try{const e=this.createTestImageBlob(),r=new File([e],"storage-test.png",{type:"image/png"}),s=yield ie(r);if(!s.success)return{name:"Upload/Delete Functionality Test",passed:!1,details:{uploadError:s.error,phase:"upload"},message:"Upload test failed"};const o=yield ne(s.filename||s.url),a=s.success&&o.success;return{name:"Upload/Delete Functionality Test",passed:a,details:{uploadSuccess:s.success,deleteSuccess:o.success,uploadedUrl:s.url,uploadError:s.error,deleteError:o.error},message:a?"Upload/Delete functionality works correctly":"Upload/Delete functionality failed"}}catch(e){return{name:"Upload/Delete Functionality Test",passed:!1,error:e.message,message:"Upload/Delete functionality test failed"}}})}createTestImageBlob(){const e=document.createElement("canvas");e.width=1,e.height=1;const r=e.getContext("2d");return r.fillStyle="#FF0000",r.fillRect(0,0,1,1),new Promise(s=>{e.toBlob(s,"image/png")})}getTestResults(){return this.testResults}exportTestResults(){return JSON.stringify({timestamp:new Date().toISOString(),results:this.testResults},null,2)}}const ve=new he;function Ke(){return i(this,arguments,function*(t={}){return yield ve.runValidationTests(t)})}class we{constructor(){this.migrationLog=[]}migrateImages(o,a){return i(this,arguments,function*(e,r,s={}){const{batchSize:n=10,onProgress:l=null,dryRun:c=!1,filter:u=null}=s;try{const d=b.getProvider(e),g=b.getProvider(r);if(!d||!g)throw new Error("Invalid provider specified");if(!d.isConfigured()||!g.isConfigured())throw new Error("Both providers must be properly configured");const p=yield d.list({limit:1e3});if(!p.success)throw new Error(`Failed to list images from ${e}: ${p.error}`);let f=p.files||[];u&&typeof u=="function"&&(f=f.filter(u));const v=f.length;let E=0,S=0;const $=[];for(let C=0;C<f.length;C+=n){const _=f.slice(C,C+n);(yield Promise.allSettled(_.map(y=>this.migrateImage(y,d,g,{dryRun:c})))).forEach((y,q)=>{const L=_[q];if(y.status==="fulfilled"&&y.value.success)E++,this.migrationLog.push({type:"success",image:L.name,timestamp:new Date().toISOString(),dryRun:c});else{S++;const U=y.status==="rejected"?y.reason:y.value.error;$.push({image:L.name,error:U.message||U}),this.migrationLog.push({type:"error",image:L.name,error:U.message||U,timestamp:new Date().toISOString(),dryRun:c})}});const B=Math.round((C+_.length)/v*100);l&&l({total:v,migrated:E,errors:S,progress:B})}return{success:!0,totalImages:v,migratedCount:E,errorCount:S,errors:$,dryRun:c,log:this.migrationLog}}catch(d){return{success:!1,error:d.message,totalImages:0,migratedCount:0,errorCount:0,errors:[],dryRun:c,log:this.migrationLog}}})}migrateImage(a,n,l){return i(this,arguments,function*(e,r,s,o={}){const{dryRun:c=!1}=o;try{if(c)return{success:!0,message:`Would migrate ${e.name}`,dryRun:!0};const u=r.getPublicUrl(e.name),d=yield fetch(u);if(!d.ok)throw new Error(`Failed to download image: ${d.statusText}`);const g=yield d.blob(),p=new File([g],e.name,{type:g.type}),f=yield s.upload(p,{filename:e.name});if(!f.success)throw new Error(f.error||"Upload failed");return{success:!0,sourceUrl:u,targetUrl:f.url,filename:e.name}}catch(u){return{success:!1,error:u.message,filename:e.name}}})}verifyMigration(e,r,s){return i(this,null,function*(){const o=b.getProvider(e),a=b.getProvider(r);if(!o||!a)throw new Error("Invalid provider specified");const n=[];let l=0,c=0;for(const u of s)try{const d=yield a.getMetadata(u.filename);d.success?(l++,n.push({filename:u.filename,status:"verified",targetExists:!0})):(c++,n.push({filename:u.filename,status:"missing",targetExists:!1,error:d.error}))}catch(d){c++,n.push({filename:u.filename,status:"error",error:d.message})}return{success:c===0,totalChecked:s.length,successCount:l,errorCount:c,results:n}})}getMigrationLog(){return this.migrationLog}clearMigrationLog(){this.migrationLog=[]}exportMigrationLog(){return JSON.stringify({timestamp:new Date().toISOString(),log:this.migrationLog},null,2)}}const ye=new we;function Ge(s,o){return i(this,arguments,function*(t,e,r={}){return yield ye.migrateImages(t,e,r)})}export{T as A,Oe as B,De as C,_e as D,ke as E,We as F,Ge as G,Te as a,Ce as b,xe as c,Re as d,Ve as e,Ue as f,Ie as g,qe as h,Be as i,ze as j,je as k,de as l,ge as m,N as n,b as o,Ke as p,$e as q,Ne as r,h as s,G as t,ie as u,pe as v,Me as w,Ae as x,Fe as y,Le as z};
