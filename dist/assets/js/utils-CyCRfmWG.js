var G=Object.defineProperty,K=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var O=(t,e,r)=>e in t?G(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$=(t,e)=>{for(var r in e||(e={}))Y.call(e,r)&&O(t,r,e[r]);if(N)for(var r of N(e))Z.call(e,r)&&O(t,r,e[r]);return t},A=(t,e)=>K(t,W(e));var i=(t,e,r)=>new Promise((s,a)=>{var o=c=>{try{l(r.next(c))}catch(u){a(u)}},n=c=>{try{l(r.throw(c))}catch(u){a(u)}},l=c=>c.done?s(c.value):Promise.resolve(c.value).then(o,n);l((r=r.apply(t,e)).next())});import{s as X}from"./vendor-CJchTyIO.js";import{c as D}from"./supabase-vendor-DEo8APS7.js";const V="https://ktxhnxmdbfkswmkikgum.supabase.co",B="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt0eGhueG1kYmZrc3dta2lrZ3VtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5NjE5OTksImV4cCI6MjA2OTUzNzk5OX0.5uWgEIlaGqHQupdBEsu76kzPDN3vzq4UFEknmKSpmHg",h=D(V,B,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0},db:{schema:"public"},global:{headers:{"X-Client-Info":"sayari-blog@1.0.0"}}}),_=D(V,B,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1},db:{schema:"public"},global:{headers:{"X-Client-Info":"sayari-blog-public@1.0.0"}}}),Fe=(t,e=150)=>{if(!t)return"";const r=t.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/\s+/g," ").trim();if(r.length<=e)return r;const s=r.substring(0,e),a=s.lastIndexOf(" ");return a>e*.8?s.substring(0,a)+"...":s+"..."},M=t=>t?(t.startsWith("http://")||t.startsWith("https://"),t):null,Le=(t,e=null)=>{if(e)return M(e);if(!t)return null;const r=t.match(/<img[^>]+src="([^"]*)"[^>]*>/i);return r?M(r[1]):null},Ne=t=>{if(!t)return"";const e=new Date(t),s=Math.abs(new Date-e),a=Math.ceil(s/(1e3*60*60*24));return a===1?"Yesterday":a<7?`${a} days ago`:a<30?`${Math.ceil(a/7)} weeks ago`:e.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},Oe=(t,e)=>{let r;return function(...a){const o=()=>{clearTimeout(r),t(...a)};clearTimeout(r),r=setTimeout(o,e)}};window.location.hostname==="localhost"||window.location.hostname==="[::1]"||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/);class H{constructor(){this.metrics={},this.observers=[],this.init()}init(){this.trackLCP(),this.trackFID(),this.trackCLS(),this.trackFCP(),this.trackTTFB(),this.trackNavigationTiming(),this.trackResourceTiming()}trackLCP(){if("PerformanceObserver"in window){const e=new PerformanceObserver(r=>{const s=r.getEntries(),a=s[s.length-1];this.metrics.lcp={value:a.startTime,element:a.element,timestamp:Date.now()},this.reportMetric("LCP",a.startTime)});e.observe({entryTypes:["largest-contentful-paint"]}),this.observers.push(e)}}trackFID(){if("PerformanceObserver"in window){const e=new PerformanceObserver(r=>{r.getEntries().forEach(a=>{this.metrics.fid={value:a.processingStart-a.startTime,timestamp:Date.now()},this.reportMetric("FID",a.processingStart-a.startTime)})});e.observe({entryTypes:["first-input"]}),this.observers.push(e)}}trackCLS(){if("PerformanceObserver"in window){let e=0;const r=new PerformanceObserver(s=>{s.getEntries().forEach(o=>{o.hadRecentInput||(e+=o.value)}),this.metrics.cls={value:e,timestamp:Date.now()},this.reportMetric("CLS",e)});r.observe({entryTypes:["layout-shift"]}),this.observers.push(r)}}trackFCP(){if("PerformanceObserver"in window){const e=new PerformanceObserver(r=>{r.getEntries().forEach(a=>{a.name==="first-contentful-paint"&&(this.metrics.fcp={value:a.startTime,timestamp:Date.now()},this.reportMetric("FCP",a.startTime))})});e.observe({entryTypes:["paint"]}),this.observers.push(e)}}trackTTFB(){if("performance"in window&&"getEntriesByType"in performance){const e=performance.getEntriesByType("navigation");if(e.length>0){const r=e[0],s=r.responseStart-r.requestStart;this.metrics.ttfb={value:s,timestamp:Date.now()},this.reportMetric("TTFB",s)}}}trackNavigationTiming(){if("performance"in window&&"getEntriesByType"in performance){const e=performance.getEntriesByType("navigation");if(e.length>0){const r=e[0];this.metrics.navigation={domContentLoaded:r.domContentLoadedEventEnd-r.domContentLoadedEventStart,loadComplete:r.loadEventEnd-r.loadEventStart,domInteractive:r.domInteractive-r.navigationStart,timestamp:Date.now()}}}}trackResourceTiming(){if("PerformanceObserver"in window){const e=new PerformanceObserver(r=>{r.getEntries().forEach(a=>{a.initiatorType==="img"&&this.trackImageLoad(a)})});e.observe({entryTypes:["resource"]}),this.observers.push(e)}}trackImageLoad(e){const r=e.responseEnd-e.startTime;this.metrics.images||(this.metrics.images=[]),this.metrics.images.push({url:e.name,loadTime:r,size:e.transferSize,timestamp:Date.now()}),r>1e3}reportMetric(e,r){window.gtag&&window.gtag("event","web_vitals",{event_category:"Performance",event_label:e,value:Math.round(r)})}getMetrics(){return this.metrics}getPerformanceScore(){const{lcp:e,fid:r,cls:s,fcp:a}=this.metrics;let o=100;return e&&(e.value>4e3?o-=30:e.value>2500&&(o-=15)),r&&(r.value>300?o-=25:r.value>100&&(o-=10)),s&&(s.value>.25?o-=25:s.value>.1&&(o-=10)),a&&(a.value>3e3?o-=20:a.value>1800&&(o-=10)),Math.max(0,o)}disconnect(){this.observers.forEach(e=>e.disconnect()),this.observers=[]}}const $e=()=>{if(typeof window!="undefined"){const t=new H;return window.addEventListener("load",()=>{setTimeout(()=>{const e=t.getPerformanceScore()},5e3)}),t}return null},Q="id, title, slug, excerpt, published_at, status, featured_image_url, content",Ae=(t=0,e=10,r="",s=null)=>i(null,null,function*(){const a=t*e,o=a+e-1;let n=_.from("posts").select(`
      ${Q},
      users:author_id (
        id,
        display_name,
        username
      ),
      post_categories (
        categories (
          id,
          name,
          slug
        )
      )
    `).eq("status","published").order("published_at",{ascending:!1}).range(a,o);r&&r.trim()&&(n=n.or(`title.ilike.%${r}%,excerpt.ilike.%${r}%`)),s&&s!=="all"&&(n=n.eq("post_categories.categories.slug",s));const{data:l,error:c,count:u}=yield n;if(c)throw new Error(`Failed to fetch posts: ${c.message}`);return{posts:l||[],hasMore:l&&l.length===e,total:u}}),Me=()=>i(null,null,function*(){const{data:t,error:e}=yield supabase.from("categories").select(`
      id, name, slug,
      post_categories (
        posts!inner (
          id
        )
      )
    `).order("name");if(e)throw new Error(`Failed to fetch categories: ${e.message}`);return(t==null?void 0:t.map(r=>{var s;return A($({},r),{post_count:((s=r.post_categories)==null?void 0:s.length)||0})}))||[]});class q{constructor(e={}){this.config=e}upload(s){return i(this,arguments,function*(e,r={}){throw new Error("upload() method must be implemented by storage provider")})}delete(e){return i(this,null,function*(){throw new Error("delete() method must be implemented by storage provider")})}getPublicUrl(e){throw new Error("getPublicUrl() method must be implemented by storage provider")}list(){return i(this,arguments,function*(e={}){throw new Error("list() method must be implemented by storage provider")})}getMetadata(e){return i(this,null,function*(){throw new Error("getMetadata() method must be implemented by storage provider")})}isConfigured(){throw new Error("isConfigured() method must be implemented by storage provider")}getProviderName(){throw new Error("getProviderName() method must be implemented by storage provider")}validateFile(e,r={}){const s=[];if(!e)return s.push("No file provided"),{valid:!1,errors:s};e.type.startsWith("image/")||s.push("File must be an image");const a=r.maxSize||5*1024*1024;return e.size>a&&s.push(`File size must be less than ${Math.round(a/1024/1024)}MB`),{valid:s.length===0,errors:s}}generateUniqueFilename(e){const r=Date.now(),s=Math.random().toString(36).substring(2,8),a=e.split(".").pop(),o=e.split(".").slice(0,-1).join(".").toLowerCase().replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,20);return`${r}-${s}-${o}.${a}`}}class ee extends q{constructor(e={}){super(e),this.bucketName=e.bucketName||"images"}upload(s){return i(this,arguments,function*(e,r={}){try{const a=this.validateFile(e,r);if(!a.valid)throw new Error(a.errors.join(", "));const o=this.generateUniqueFilename(e.name);r.onProgress&&r.onProgress(10);const{data:n,error:l}=yield h.storage.from(this.bucketName).upload(o,e,{contentType:e.type,upsert:!1});if(l)throw new Error(`Upload failed: ${l.message}`);r.onProgress&&r.onProgress(90);const{data:{publicUrl:c}}=h.storage.from(this.bucketName).getPublicUrl(o);return r.onProgress&&r.onProgress(100),{success:!0,url:c,filename:o,path:n.path,provider:"supabase"}}catch(a){return{success:!1,error:a.message,provider:"supabase"}}})}delete(e){return i(this,null,function*(){try{if(!e)throw new Error("No file identifier provided");let r=e;e.includes(`/storage/v1/object/public/${this.bucketName}/`)&&(r=e.split(`/${this.bucketName}/`).pop());const{error:s}=yield h.storage.from(this.bucketName).remove([r]);if(s)throw new Error(`Delete failed: ${s.message}`);return{success:!0,message:"Image deleted successfully",provider:"supabase"}}catch(r){return{success:!1,error:r.message,provider:"supabase"}}})}getPublicUrl(e){if(!e||e.startsWith("http"))return e;const r=e.startsWith("/")?e.slice(1):e,{data:{publicUrl:s}}=h.storage.from(this.bucketName).getPublicUrl(r);return s}list(){return i(this,arguments,function*(e={}){try{const{limit:r=100,offset:s=0}=e,{data:a,error:o}=yield h.storage.from(this.bucketName).list("",{limit:r,offset:s,sortBy:{column:"created_at",order:"desc"}});if(o)throw new Error(`Failed to list images: ${o.message}`);return{success:!0,files:a||[],provider:"supabase"}}catch(r){return{success:!1,error:r.message,files:[],provider:"supabase"}}})}getMetadata(e){return i(this,null,function*(){try{if(!e)throw new Error("No file identifier provided");let r=e;e.includes(`/storage/v1/object/public/${this.bucketName}/`)&&(r=e.split(`/${this.bucketName}/`).pop());const{data:s,error:a}=yield h.storage.from(this.bucketName).list("",{search:r});if(a)throw new Error(`Failed to get metadata: ${a.message}`);const o=s.find(n=>n.name===r);if(!o)throw new Error("Image not found");return{success:!0,metadata:o,provider:"supabase"}}catch(r){return{success:!1,error:r.message,metadata:null,provider:"supabase"}}})}isConfigured(){try{return!!("https://ktxhnxmdbfkswmkikgum.supabase.co"&&"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt0eGhueG1kYmZrc3dta2lrZ3VtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5NjE5OTksImV4cCI6MjA2OTUzNzk5OX0.5uWgEIlaGqHQupdBEsu76kzPDN3vzq4UFEknmKSpmHg")}catch(e){return!1}}getProviderName(){return"supabase"}}function re(t,e){return i(this,null,function*(){try{const r=yield fetch("/api/r2/presigned-upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:t,contentType:e})});if(!r.ok)throw new Error(`Failed to get presigned URL: ${r.statusText}`);return yield r.json()}catch(r){throw r}})}function te(s,a){return i(this,arguments,function*(t,e,r={}){try{const{onProgress:o}=r;o&&o(20);const n=yield fetch(t,{method:"PUT",body:e,headers:{"Content-Type":e.type}});if(o&&o(90),!n.ok)throw new Error(`Upload failed: ${n.statusText}`);return o&&o(100),{success:!0,message:"Upload completed successfully"}}catch(o){return{success:!1,error:o.message}}})}function se(t){return i(this,null,function*(){try{const e=yield fetch("/api/r2/delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:t})});if(!e.ok)throw new Error(`Delete failed: ${e.statusText}`);return yield e.json()}catch(e){return{success:!1,error:e.message}}})}function ae(){return i(this,arguments,function*(t={}){try{const e=new URLSearchParams;t.limit&&e.set("limit",t.limit),t.offset&&e.set("offset",t.offset);const r=yield fetch(`/api/r2/list?${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`List failed: ${r.statusText}`);return yield r.json()}catch(e){return{success:!1,error:e.message,files:[]}}})}function oe(t){return i(this,null,function*(){try{const e=yield fetch(`/api/r2/metadata?filename=${encodeURIComponent(t)}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Metadata request failed: ${e.statusText}`);return yield e.json()}catch(e){return{success:!1,error:e.message,metadata:null}}})}class ie extends q{constructor(e={}){super(e),this.accountId=e.accountId||"ab54ca2d01df4886aa0c3f240ace806d",this.accessKeyId=e.accessKeyId||"399a86b7cc9968e58d9843168aa82f61",this.secretAccessKey=e.secretAccessKey||"d24937a919cbdcd3019d9228004d11306867c8e5bb3373e2ff37cf2b3356ecc6",this.bucketName=e.bucketName||"boopul",this.publicUrl=e.publicUrl||"https://pub-fc97d8e973a94b6ab42a5785e3a4130e.r2.dev",this.endpoint=e.endpoint||"https://ab54ca2d01df4886aa0c3f240ace806d.r2.cloudflarestorage.com"}upload(s){return i(this,arguments,function*(e,r={}){try{const a=this.validateFile(e,r);if(!a.valid)throw new Error(a.errors.join(", "));const o=this.generateUniqueFilename(e.name);r.onProgress&&r.onProgress(10);const n=yield re(o,e.type);if(!n.success)throw new Error(n.error||"Failed to get presigned URL");r.onProgress&&r.onProgress(30);const l=yield te(n.url,e,{onProgress:u=>{const d=30+u*.7;r.onProgress&&r.onProgress(Math.round(d))}});if(!l.success)throw new Error(l.error||"Upload failed");return{success:!0,url:this.getPublicUrl(o),filename:o,path:o,provider:"cloudflare-r2"}}catch(a){return{success:!1,error:a.message,provider:"cloudflare-r2"}}})}delete(e){return i(this,null,function*(){try{if(!e)throw new Error("No file identifier provided");let r=e;e.includes(this.publicUrl)&&(r=e.replace(`${this.publicUrl}/`,""));const s=yield se(r);return{success:s.success,message:s.success?"Image deleted successfully":s.error,error:s.success?void 0:s.error,provider:"cloudflare-r2"}}catch(r){return{success:!1,error:r.message,provider:"cloudflare-r2"}}})}getPublicUrl(e){if(!e||e.startsWith("http"))return e;const r=e.startsWith("/")?e.slice(1):e;return`${this.publicUrl}/${r}`}list(){return i(this,arguments,function*(e={}){try{const r=yield ae(e);return{success:r.success,files:r.files||[],error:r.success?void 0:r.error,provider:"cloudflare-r2"}}catch(r){return{success:!1,error:r.message,files:[],provider:"cloudflare-r2"}}})}getMetadata(e){return i(this,null,function*(){try{if(!e)throw new Error("No file identifier provided");let r=e;e.includes(this.publicUrl)&&(r=e.replace(`${this.publicUrl}/`,""));const s=yield oe(r);return{success:s.success,metadata:s.metadata,error:s.success?void 0:s.error,provider:"cloudflare-r2"}}catch(r){return{success:!1,error:r.message,metadata:null,provider:"cloudflare-r2"}}})}isConfigured(){return!!(this.accountId&&this.accessKeyId&&this.secretAccessKey&&this.bucketName&&this.publicUrl&&this.endpoint)}getProviderName(){return"cloudflare-r2"}}const ne={BASE_URL:"/",DEV:!0,MODE:"production",PROD:!1,SSG_MODE:"true",SSR:!1,VITE_CLOUDFLARE_ACCOUNT_ID:"ab54ca2d01df4886aa0c3f240ace806d",VITE_CLOUDFLARE_R2_ACCESS_KEY_ID:"399a86b7cc9968e58d9843168aa82f61",VITE_CLOUDFLARE_R2_BUCKET_NAME:"boopul",VITE_CLOUDFLARE_R2_ENDPOINT:"https://ab54ca2d01df4886aa0c3f240ace806d.r2.cloudflarestorage.com",VITE_CLOUDFLARE_R2_PUBLIC_URL:"https://pub-fc97d8e973a94b6ab42a5785e3a4130e.r2.dev",VITE_CLOUDFLARE_R2_SECRET_ACCESS_KEY:"d24937a919cbdcd3019d9228004d11306867c8e5bb3373e2ff37cf2b3356ecc6",VITE_STORAGE_PROVIDER:"cloudflare-r2",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt0eGhueG1kYmZrc3dta2lrZ3VtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5NjE5OTksImV4cCI6MjA2OTUzNzk5OX0.5uWgEIlaGqHQupdBEsu76kzPDN3vzq4UFEknmKSpmHg",VITE_SUPABASE_URL:"https://ktxhnxmdbfkswmkikgum.supabase.co",VITE_USER_NODE_ENV:"development"},b={SUPABASE:"supabase",CLOUDFLARE_R2:"cloudflare-r2"};class F{constructor(){this.providers=new Map,this.currentProvider=null,this.fallbackProvider=null,this.initializeProviders(),this.setCurrentProvider()}initializeProviders(){const e=new ee({bucketName:"images"});this.providers.set(b.SUPABASE,e);const r=new ie;this.providers.set(b.CLOUDFLARE_R2,r)}setCurrentProvider(){const e="cloudflare-r2";this.providers.has(e)?this.providers.get(e).isConfigured()?this.currentProvider=e:this.setFallbackProvider(e):this.setFallbackProvider(),this.currentProvider||(this.currentProvider=this.fallbackProvider,this.currentProvider)}setFallbackProvider(e=null){for(const[r,s]of this.providers)if(r!==e&&s.isConfigured()){this.fallbackProvider=r;break}!this.fallbackProvider&&this.providers.has(b.SUPABASE)&&this.providers.get(b.SUPABASE).isConfigured()&&(this.fallbackProvider=b.SUPABASE)}getCurrentProvider(){return this.currentProvider?this.providers.get(this.currentProvider):null}getProvider(e){return this.providers.get(e)||null}switchProvider(e){return!this.providers.has(e)||!this.providers.get(e).isConfigured()?!1:(this.currentProvider=e,!0)}getConfigurationStatus(){const e={current:this.currentProvider,fallback:this.fallbackProvider,providers:{}};for(const[r,s]of this.providers)e.providers[r]={configured:s.isConfigured(),name:s.getProviderName()};return e}validateConfiguration(){const e=[],r=[],s=Array.from(this.providers.entries()).filter(([a,o])=>o.isConfigured());if(s.length===0&&e.push("No storage providers are properly configured"),!this.currentProvider)e.push("No current storage provider is set");else{const a=this.getCurrentProvider();(!a||!a.isConfigured())&&e.push(`Current provider '${this.currentProvider}' is not properly configured`)}return!this.fallbackProvider&&s.length>1&&r.push("No fallback provider is available"),{valid:e.length===0,errors:e,warnings:r,configuredProviders:s.length,totalProviders:this.providers.size}}static getRequiredEnvironmentVariables(){return{[b.SUPABASE]:["VITE_SUPABASE_URL","VITE_SUPABASE_ANON_KEY"],[b.CLOUDFLARE_R2]:["VITE_CLOUDFLARE_ACCOUNT_ID","VITE_CLOUDFLARE_R2_ACCESS_KEY_ID","VITE_CLOUDFLARE_R2_SECRET_ACCESS_KEY","VITE_CLOUDFLARE_R2_BUCKET_NAME","VITE_CLOUDFLARE_R2_PUBLIC_URL","VITE_CLOUDFLARE_R2_ENDPOINT"],general:["VITE_STORAGE_PROVIDER"]}}static checkMissingEnvironmentVariables(){const e=F.getRequiredEnvironmentVariables(),r={};for(const[s,a]of Object.entries(e))r[s]=a.filter(o=>!ne[o]);return r}}const y=new F;function E(){return y.getCurrentProvider()}function ce(){return y.getConfigurationStatus()}function le(){return y.validateConfiguration()}function ue(r){return i(this,arguments,function*(t,e={}){const s=E();if(!s)return{success:!1,error:"No storage provider is configured",provider:"none"};try{const a=yield s.upload(t,e);return a.provider||(a.provider=s.getProviderName()),a}catch(a){return{success:!1,error:a.message,provider:s.getProviderName()}}})}function de(t){return i(this,null,function*(){const e=E();if(!e)return{success:!1,error:"No storage provider is configured",provider:"none"};try{const r=yield e.delete(t);return r.provider||(r.provider=e.getProviderName()),r}catch(r){return{success:!1,error:r.message,provider:e.getProviderName()}}})}function ge(t){const e=E();if(!e)return t;try{return e.getPublicUrl(t)}catch(r){return t}}function fe(){return i(this,arguments,function*(t={}){const e=E();if(!e)return{success:!1,error:"No storage provider is configured",files:[],provider:"none"};try{const r=yield e.list(t);return r.provider||(r.provider=e.getProviderName()),r}catch(r){return{success:!1,error:r.message,files:[],provider:e.getProviderName()}}})}function me(t){return i(this,null,function*(){const e=E();if(!e)return{success:!1,error:"No storage provider is configured",metadata:null,provider:"none"};try{const r=yield e.getMetadata(t);return r.provider||(r.provider=e.getProviderName()),r}catch(r){return{success:!1,error:r.message,metadata:null,provider:e.getProviderName()}}})}function De(){const t=E();return t?t.getProviderName():null}function pe(){return ce()}function he(){return le()}let m={posts:null,authors:null,categories:null,tags:null};function U(t){return i(this,null,function*(){try{const e=yield fetch(`/data/static/${t}`);if(!e.ok)throw new Error(`Failed to load ${t}: ${e.status}`);return yield e.json()}catch(e){return null}})}function k(){return i(this,null,function*(){if(m.posts||(m.posts=yield U("posts.json")),m.posts)return m.posts;const{data:t,error:e}=yield _.from("posts").select(`
      id,
      title,
      slug,
      content,
      excerpt,
      author_id,
      published_at,
      status,
      featured_image_url,
      authors:author_id (
        id,
        username,
        display_name,
        bio
      )
    `).eq("status","published").order("published_at",{ascending:!1});if(e)throw new Error(`Failed to fetch posts: ${e.message}`);return t||[]})}function Ve(t){return i(this,null,function*(){return(yield k()).find(r=>r.slug===t)||null})}function ve(){return i(this,null,function*(){if(m.authors||(m.authors=yield U("authors.json")),m.authors)return m.authors;const{data:t,error:e}=yield _.from("users").select("id, user_login, display_name, user_registered").order("display_name");if(e)throw new Error(`Failed to fetch authors: ${e.message}`);return t||[]})}function Be(t){return i(this,null,function*(){return(yield ve()).find(r=>r.username===t)||null})}function qe(t,e=""){return i(this,null,function*(){let s=(yield k()).filter(a=>a.author_id===t);if(e&&e.trim()){const a=e.toLowerCase();s=s.filter(o=>{var n,l;return o.title.toLowerCase().includes(a)||((n=o.excerpt)==null?void 0:n.toLowerCase().includes(a))||((l=o.content)==null?void 0:l.toLowerCase().includes(a))})}return s})}function we(){return i(this,null,function*(){if(m.categories||(m.categories=yield U("categories.json")),m.categories)return m.categories;const{data:t,error:e}=yield _.from("categories").select("id, name, slug, description").order("name");if(e)throw new Error(`Failed to fetch categories: ${e.message}`);return t||[]})}function xe(t){return i(this,null,function*(){return(yield we()).find(r=>r.slug===t)||null})}function je(t,e=""){return i(this,null,function*(){let s=(yield k()).filter(a=>a.categories&&a.categories.some(o=>o.id===t));if(e&&e.trim()){const a=e.toLowerCase();s=s.filter(o=>{var n,l;return o.title.toLowerCase().includes(a)||((n=o.excerpt)==null?void 0:n.toLowerCase().includes(a))||((l=o.content)==null?void 0:l.toLowerCase().includes(a))})}return s})}function be(){return i(this,null,function*(){if(m.tags||(m.tags=yield U("tags.json")),m.tags)return m.tags;const{data:t,error:e}=yield _.from("tags").select("id, name, slug, description").order("name");if(e)throw new Error(`Failed to fetch tags: ${e.message}`);return t||[]})}function ze(t){return i(this,null,function*(){return(yield be()).find(r=>r.slug===t)||null})}function Je(t,e=""){return i(this,null,function*(){let s=(yield k()).filter(a=>a.tags&&a.tags.some(o=>o.id===t));if(e&&e.trim()){const a=e.toLowerCase();s=s.filter(o=>{var n,l;return o.title.toLowerCase().includes(a)||((n=o.excerpt)==null?void 0:n.toLowerCase().includes(a))||((l=o.content)==null?void 0:l.toLowerCase().includes(a))})}return s})}const Ge=(r,...s)=>i(null,[r,...s],function*(t,e={}){const{maxWidth:a=1200,maxHeight:o=800,quality:n=.8,format:l="image/jpeg"}=e;return new Promise((c,u)=>{const d=document.createElement("canvas"),f=d.getContext("2d"),p=new Image;p.onload=()=>{let{width:g,height:v}=p;g>a&&(v=v*a/g,g=a),v>o&&(g=g*o/v,v=o),d.width=g,d.height=v,f.drawImage(p,0,0,g,v),d.toBlob(P=>{if(P){const S=new File([P],t.name,{type:l,lastModified:Date.now()});c(S)}else u(new Error("Failed to compress image"))},l,n)},p.onerror=()=>{u(new Error("Failed to load image"))},p.src=URL.createObjectURL(t)})}),ye={अ:"a",आ:"aa",इ:"i",ई:"ii",उ:"u",ऊ:"uu",ए:"e",ऐ:"ai",ओ:"o",औ:"au",क:"ka",ख:"kha",ग:"ga",घ:"gha",ङ:"nga",च:"cha",छ:"chha",ज:"ja",झ:"jha",ञ:"nya",ट:"ta",ठ:"tha",ड:"da",ढ:"dha",ण:"na",त:"ta",थ:"tha",द:"da",ध:"dha",न:"na",प:"pa",फ:"pha",ब:"ba",भ:"bha",म:"ma",य:"ya",र:"ra",ल:"la",व:"va",श:"sha",ष:"sha",स:"sa",ह:"ha",क्ष:"ksha",त्र:"tra",ज्ञ:"gya","ं":"n","ः":"h","्":"","ा":"aa","ि":"i","ी":"ii","ु":"u","ू":"uu","े":"e","ै":"ai","ो":"o","ौ":"au"},Ee=t=>{if(!t)return"";let e=t;return Object.entries(ye).forEach(([r,s])=>{const a=new RegExp(r,"g");e=e.replace(a,s)}),e},Ke=t=>{if(!t)return"";const e=Ee(t),r=X(e,{lower:!0,strict:!0,remove:/[*+~.()'"!:@]/g});return r?r.substring(0,100):`post-${Date.now()}`},Pe=(t,e=null)=>i(null,null,function*(){if(!t)return!1;try{let r=h.from("posts").select("id").eq("slug",t);e&&(r=r.neq("id",e));const{data:s,error:a}=yield r;return a?!1:!s||s.length===0}catch(r){return!1}}),x=(t,e=null)=>i(null,null,function*(){let r=t,s=1;for(;!(yield Pe(r,e));)if(r=`${t}-${s}`,s++,s>100){r=`${t}-${Date.now()}`;break}return r}),j=t=>t?t.length<3?{isValid:!1,message:"Slug must be at least 3 characters long"}:t.length>100?{isValid:!1,message:"Slug must be less than 100 characters"}:/^[a-z0-9-]+$/.test(t)?t.startsWith("-")||t.endsWith("-")?{isValid:!1,message:"Slug cannot start or end with a hyphen"}:t.includes("--")?{isValid:!1,message:"Slug cannot contain consecutive hyphens"}:["admin","api","www","mail","ftp","localhost","test","staging","dev","development","prod","production","blog","post","page","category","tag","author","search"].includes(t)?{isValid:!1,message:"This slug is reserved and cannot be used"}:{isValid:!0,message:""}:{isValid:!1,message:"Slug can only contain lowercase letters, numbers, and hyphens"}:{isValid:!1,message:"Slug is required"},We=t=>i(null,null,function*(){try{if(!t.title)throw new Error("Title is required");const e=j(t.slug);if(!e.isValid)throw new Error(e.message);const r=yield x(t.slug),{data:{user:s}}=yield h.auth.getUser();if(!s)throw new Error("You must be logged in to create posts");const a={title:t.title.trim(),slug:r,content:t.content||"",excerpt:t.excerpt||"",status:t.status||"draft",featured_image_url:t.featured_image_url||null,meta_title:t.meta_title||null,meta_description:t.meta_description||null,author_id:s.id,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};a.status==="published"&&(a.published_at=t.published_at||new Date().toISOString());const{data:o,error:n}=yield h.from("posts").insert([a]).select().single();if(n)throw new Error(`Failed to create post: ${n.message}`);return o}catch(e){throw e}}),Ye=(t,e)=>i(null,null,function*(){try{if(!t)throw new Error("Post ID is required");if(!e.title)throw new Error("Title is required");if(e.slug){const o=j(e.slug);if(!o.isValid)throw new Error(o.message);const n=yield x(e.slug,t);e.slug=n}const r={title:e.title.trim(),content:e.content||"",excerpt:e.excerpt||"",status:e.status||"draft",featured_image_url:e.featured_image_url||null,meta_title:e.meta_title||null,meta_description:e.meta_description||null,updated_at:new Date().toISOString()};if(e.slug&&(r.slug=e.slug),r.status==="published"&&e.published_at)r.published_at=e.published_at;else if(r.status==="published"){const{data:o}=yield h.from("posts").select("published_at").eq("id",t).single();o!=null&&o.published_at||(r.published_at=new Date().toISOString())}const{data:s,error:a}=yield h.from("posts").update(r).eq("id",t).select().single();if(a)throw new Error(`Failed to update post: ${a.message}`);return s}catch(r){throw r}}),Ze=t=>i(null,null,function*(){try{if(!t)throw new Error("Post ID is required");const{error:e}=yield h.from("posts").delete().eq("id",t);if(e)throw new Error(`Failed to delete post: ${e.message}`);return!0}catch(e){throw e}}),Xe=(...e)=>i(null,[...e],function*(t={}){try{const{page:r=0,limit:s=10,status:a=null,search:o="",orderBy:n="updated_at",orderDirection:l="desc"}=t;let c=h.from("posts").select("id, title, slug, status, published_at, created_at, updated_at",{count:"exact"});a&&a!=="all"&&(c=c.eq("status",a)),o&&o.trim()&&(c=c.ilike("title",`%${o.trim()}%`)),c=c.order(n,{ascending:l==="asc"});const u=r*s,d=u+s-1;c=c.range(u,d);const{data:f,error:p,count:g}=yield c;if(p)throw new Error(`Failed to fetch posts: ${p.message}`);return{posts:f||[],total:g||0,page:r,limit:s,hasMore:f&&f.length===s}}catch(r){throw r}}),He=(t,e)=>i(null,null,function*(){try{if(!t||t.length===0)throw new Error("Post IDs are required");if(!["draft","published","private"].includes(e))throw new Error("Invalid status");const r={status:e,updated_at:new Date().toISOString()};e==="published"&&(r.published_at=new Date().toISOString());const{data:s,error:a}=yield h.from("posts").update(r).in("id",t).select("id");if(a)throw new Error(`Failed to update posts: ${a.message}`);return s?s.length:0}catch(r){throw r}});class Se{constructor(){this.testResults=[]}runValidationTests(){return i(this,arguments,function*(e={}){const{includeUploadTest:r=!1,testImageUrl:s=null}=e;this.testResults=[];let a=0,o=0;o++;const n=yield this.testConfiguration();n.passed&&a++,this.testResults.push(n),o++;const l=yield this.testProviderAvailability();l.passed&&a++,this.testResults.push(l),o++;const c=yield this.testUrlGeneration();c.passed&&a++,this.testResults.push(c),o++;const u=yield this.testListFunctionality();if(u.passed&&a++,this.testResults.push(u),s){o++;const f=yield this.testMetadataFunctionality(s);f.passed&&a++,this.testResults.push(f)}if(r){o++;const f=yield this.testUploadDeleteFunctionality();f.passed&&a++,this.testResults.push(f)}return{success:a===o,passedTests:a,totalTests:o,passRate:Math.round(a/o*100),results:this.testResults,timestamp:new Date().toISOString()}})}testConfiguration(){return i(this,null,function*(){try{const e=pe(),r=he(),s=r.valid&&e.current!==null;return{name:"Configuration Test",passed:s,details:{currentProvider:e.current,configuredProviders:Object.keys(e.providers).filter(a=>e.providers[a].configured),validationErrors:r.errors,validationWarnings:r.warnings},message:s?"Storage configuration is valid":"Storage configuration has issues"}}catch(e){return{name:"Configuration Test",passed:!1,error:e.message,message:"Configuration test failed"}}})}testProviderAvailability(){return i(this,null,function*(){try{const e=E(),r=e!==null&&e.isConfigured();return{name:"Provider Availability Test",passed:r,details:{providerName:e?e.getProviderName():"none",isConfigured:e?e.isConfigured():!1},message:r?"Storage provider is available and configured":"Storage provider is not available"}}catch(e){return{name:"Provider Availability Test",passed:!1,error:e.message,message:"Provider availability test failed"}}})}testUrlGeneration(){return i(this,null,function*(){try{const e="test-image.jpg",r=ge(e),s=typeof r=="string"&&r.length>0&&r!==e;return{name:"URL Generation Test",passed:s,details:{testFilename:e,generatedUrl:r,urlLength:r?r.length:0},message:s?"URL generation works correctly":"URL generation failed"}}catch(e){return{name:"URL Generation Test",passed:!1,error:e.message,message:"URL generation test failed"}}})}testListFunctionality(){return i(this,null,function*(){try{const e=yield fe({limit:5}),r=e.success&&Array.isArray(e.files);return{name:"List Functionality Test",passed:r,details:{success:e.success,fileCount:e.files?e.files.length:0,error:e.error},message:r?"List functionality works correctly":"List functionality failed"}}catch(e){return{name:"List Functionality Test",passed:!1,error:e.message,message:"List functionality test failed"}}})}testMetadataFunctionality(e){return i(this,null,function*(){try{const r=yield me(e),s=r.success&&r.metadata!==null;return{name:"Metadata Functionality Test",passed:s,details:{testImageUrl:e,success:r.success,hasMetadata:r.metadata!==null,error:r.error},message:s?"Metadata functionality works correctly":"Metadata functionality failed"}}catch(r){return{name:"Metadata Functionality Test",passed:!1,error:r.message,message:"Metadata functionality test failed"}}})}testUploadDeleteFunctionality(){return i(this,null,function*(){try{const e=this.createTestImageBlob(),r=new File([e],"storage-test.png",{type:"image/png"}),s=yield ue(r);if(!s.success)return{name:"Upload/Delete Functionality Test",passed:!1,details:{uploadError:s.error,phase:"upload"},message:"Upload test failed"};const a=yield de(s.filename||s.url),o=s.success&&a.success;return{name:"Upload/Delete Functionality Test",passed:o,details:{uploadSuccess:s.success,deleteSuccess:a.success,uploadedUrl:s.url,uploadError:s.error,deleteError:a.error},message:o?"Upload/Delete functionality works correctly":"Upload/Delete functionality failed"}}catch(e){return{name:"Upload/Delete Functionality Test",passed:!1,error:e.message,message:"Upload/Delete functionality test failed"}}})}createTestImageBlob(){const e=document.createElement("canvas");e.width=1,e.height=1;const r=e.getContext("2d");return r.fillStyle="#FF0000",r.fillRect(0,0,1,1),new Promise(s=>{e.toBlob(s,"image/png")})}getTestResults(){return this.testResults}exportTestResults(){return JSON.stringify({timestamp:new Date().toISOString(),results:this.testResults},null,2)}}const Ce=new Se;function Qe(){return i(this,arguments,function*(t={}){return yield Ce.runValidationTests(t)})}class _e{constructor(){this.migrationLog=[]}migrateImages(a,o){return i(this,arguments,function*(e,r,s={}){const{batchSize:n=10,onProgress:l=null,dryRun:c=!1,filter:u=null}=s;try{const d=y.getProvider(e),f=y.getProvider(r);if(!d||!f)throw new Error("Invalid provider specified");if(!d.isConfigured()||!f.isConfigured())throw new Error("Both providers must be properly configured");const p=yield d.list({limit:1e3});if(!p.success)throw new Error(`Failed to list images from ${e}: ${p.error}`);let g=p.files||[];u&&typeof u=="function"&&(g=g.filter(u));const v=g.length;let P=0,S=0;const L=[];for(let C=0;C<g.length;C+=n){const I=g.slice(C,C+n);(yield Promise.allSettled(I.map(w=>this.migrateImage(w,d,f,{dryRun:c})))).forEach((w,J)=>{const R=I[J];if(w.status==="fulfilled"&&w.value.success)P++,this.migrationLog.push({type:"success",image:R.name,timestamp:new Date().toISOString(),dryRun:c});else{S++;const T=w.status==="rejected"?w.reason:w.value.error;L.push({image:R.name,error:T.message||T}),this.migrationLog.push({type:"error",image:R.name,error:T.message||T,timestamp:new Date().toISOString(),dryRun:c})}});const z=Math.round((C+I.length)/v*100);l&&l({total:v,migrated:P,errors:S,progress:z})}return{success:!0,totalImages:v,migratedCount:P,errorCount:S,errors:L,dryRun:c,log:this.migrationLog}}catch(d){return{success:!1,error:d.message,totalImages:0,migratedCount:0,errorCount:0,errors:[],dryRun:c,log:this.migrationLog}}})}migrateImage(o,n,l){return i(this,arguments,function*(e,r,s,a={}){const{dryRun:c=!1}=a;try{if(c)return{success:!0,message:`Would migrate ${e.name}`,dryRun:!0};const u=r.getPublicUrl(e.name),d=yield fetch(u);if(!d.ok)throw new Error(`Failed to download image: ${d.statusText}`);const f=yield d.blob(),p=new File([f],e.name,{type:f.type}),g=yield s.upload(p,{filename:e.name});if(!g.success)throw new Error(g.error||"Upload failed");return{success:!0,sourceUrl:u,targetUrl:g.url,filename:e.name}}catch(u){return{success:!1,error:u.message,filename:e.name}}})}verifyMigration(e,r,s){return i(this,null,function*(){const a=y.getProvider(e),o=y.getProvider(r);if(!a||!o)throw new Error("Invalid provider specified");const n=[];let l=0,c=0;for(const u of s)try{const d=yield o.getMetadata(u.filename);d.success?(l++,n.push({filename:u.filename,status:"verified",targetExists:!0})):(c++,n.push({filename:u.filename,status:"missing",targetExists:!1,error:d.error}))}catch(d){c++,n.push({filename:u.filename,status:"error",error:d.message})}return{success:c===0,totalChecked:s.length,successCount:l,errorCount:c,results:n}})}getMigrationLog(){return this.migrationLog}clearMigrationLog(){this.migrationLog=[]}exportMigrationLog(){return JSON.stringify({timestamp:new Date().toISOString(),log:this.migrationLog},null,2)}}const Te=new _e;function er(s,a){return i(this,arguments,function*(t,e,r={}){return yield Te.migrateImages(t,e,r)})}export{Ve as A,k as B,ze as C,Je as D,$e as E,Xe as F,er as G,Le as a,Fe as b,Me as c,Oe as d,Ge as e,Ne as f,De as g,Ke as h,Ye as i,We as j,He as k,Ze as l,pe as m,M as n,he as o,y as p,Qe as q,Be as r,h as s,qe as t,ue as u,Pe as v,ve as w,xe as x,je as y,Ae as z};
