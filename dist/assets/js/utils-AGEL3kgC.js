var i=(s,e,r)=>new Promise((t,a)=>{var o=c=>{try{l(r.next(c))}catch(u){a(u)}},n=c=>{try{l(r.throw(c))}catch(u){a(u)}},l=c=>c.done?t(c.value):Promise.resolve(c.value).then(o,n);l((r=r.apply(s,e)).next())});import{s as q}from"./vendor-CJchTyIO.js";import{c as N}from"./supabase-vendor-DEo8APS7.js";const O="https://ktxhnxmdbfkswmkikgum.supabase.co",$="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt0eGhueG1kYmZrc3dta2lrZ3VtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5NjE5OTksImV4cCI6MjA2OTUzNzk5OX0.5uWgEIlaGqHQupdBEsu76kzPDN3vzq4UFEknmKSpmHg",h=N(O,$,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0},db:{schema:"public"},global:{headers:{"X-Client-Info":"sayari-blog@1.0.0"}}}),U=N(O,$,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1},db:{schema:"public"},global:{headers:{"X-Client-Info":"sayari-blog-public@1.0.0"}}}),ye=(s,e=150)=>{if(!s)return"";const r=s.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/\s+/g," ").trim();if(r.length<=e)return r;const t=r.substring(0,e),a=t.lastIndexOf(" ");return a>e*.8?t.substring(0,a)+"...":t+"..."},Ee=(s,e=null)=>{if(e)return e;if(!s)return null;const r=s.match(/<img[^>]+src="([^"]*)"[^>]*>/i);return r?r[1]:null},Pe=s=>{if(!s)return"";const e=new Date(s),t=Math.abs(new Date-e),a=Math.ceil(t/(1e3*60*60*24));return a===1?"Yesterday":a<7?`${a} days ago`:a<30?`${Math.ceil(a/7)} weeks ago`:e.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},Se=(s,e)=>{let r;return function(...a){const o=()=>{clearTimeout(r),s(...a)};clearTimeout(r),r=setTimeout(o,e)}},Ce=s=>s||null;window.location.hostname==="localhost"||window.location.hostname==="[::1]"||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/);class B{constructor(){this.metrics={},this.observers=[],this.init()}init(){this.trackLCP(),this.trackFID(),this.trackCLS(),this.trackFCP(),this.trackTTFB(),this.trackNavigationTiming(),this.trackResourceTiming()}trackLCP(){if("PerformanceObserver"in window){const e=new PerformanceObserver(r=>{const t=r.getEntries(),a=t[t.length-1];this.metrics.lcp={value:a.startTime,element:a.element,timestamp:Date.now()},this.reportMetric("LCP",a.startTime)});e.observe({entryTypes:["largest-contentful-paint"]}),this.observers.push(e)}}trackFID(){if("PerformanceObserver"in window){const e=new PerformanceObserver(r=>{r.getEntries().forEach(a=>{this.metrics.fid={value:a.processingStart-a.startTime,timestamp:Date.now()},this.reportMetric("FID",a.processingStart-a.startTime)})});e.observe({entryTypes:["first-input"]}),this.observers.push(e)}}trackCLS(){if("PerformanceObserver"in window){let e=0;const r=new PerformanceObserver(t=>{t.getEntries().forEach(o=>{o.hadRecentInput||(e+=o.value)}),this.metrics.cls={value:e,timestamp:Date.now()},this.reportMetric("CLS",e)});r.observe({entryTypes:["layout-shift"]}),this.observers.push(r)}}trackFCP(){if("PerformanceObserver"in window){const e=new PerformanceObserver(r=>{r.getEntries().forEach(a=>{a.name==="first-contentful-paint"&&(this.metrics.fcp={value:a.startTime,timestamp:Date.now()},this.reportMetric("FCP",a.startTime))})});e.observe({entryTypes:["paint"]}),this.observers.push(e)}}trackTTFB(){if("performance"in window&&"getEntriesByType"in performance){const e=performance.getEntriesByType("navigation");if(e.length>0){const r=e[0],t=r.responseStart-r.requestStart;this.metrics.ttfb={value:t,timestamp:Date.now()},this.reportMetric("TTFB",t)}}}trackNavigationTiming(){if("performance"in window&&"getEntriesByType"in performance){const e=performance.getEntriesByType("navigation");if(e.length>0){const r=e[0];this.metrics.navigation={domContentLoaded:r.domContentLoadedEventEnd-r.domContentLoadedEventStart,loadComplete:r.loadEventEnd-r.loadEventStart,domInteractive:r.domInteractive-r.navigationStart,timestamp:Date.now()}}}}trackResourceTiming(){if("PerformanceObserver"in window){const e=new PerformanceObserver(r=>{r.getEntries().forEach(a=>{a.initiatorType==="img"&&this.trackImageLoad(a)})});e.observe({entryTypes:["resource"]}),this.observers.push(e)}}trackImageLoad(e){const r=e.responseEnd-e.startTime;this.metrics.images||(this.metrics.images=[]),this.metrics.images.push({url:e.name,loadTime:r,size:e.transferSize,timestamp:Date.now()}),r>1e3}reportMetric(e,r){window.gtag&&window.gtag("event","web_vitals",{event_category:"Performance",event_label:e,value:Math.round(r)})}getMetrics(){return this.metrics}getPerformanceScore(){const{lcp:e,fid:r,cls:t,fcp:a}=this.metrics;let o=100;return e&&(e.value>4e3?o-=30:e.value>2500&&(o-=15)),r&&(r.value>300?o-=25:r.value>100&&(o-=10)),t&&(t.value>.25?o-=25:t.value>.1&&(o-=10)),a&&(a.value>3e3?o-=20:a.value>1800&&(o-=10)),Math.max(0,o)}disconnect(){this.observers.forEach(e=>e.disconnect()),this.observers=[]}}const Te=()=>{if(typeof window!="undefined"){const s=new B;return window.addEventListener("load",()=>{setTimeout(()=>{const e=s.getPerformanceScore()},5e3)}),s}return null};let f={posts:null,authors:null,categories:null,tags:null};function R(s){return i(this,null,function*(){try{const e=yield fetch(`/data/static/${s}`);if(!e.ok)throw new Error(`Failed to load ${s}: ${e.status}`);return yield e.json()}catch(e){return null}})}function C(){return i(this,null,function*(){if(f.posts||(f.posts=yield R("posts.json")),f.posts)return f.posts;const{data:s,error:e}=yield U.from("posts").select(`
      id,
      title,
      slug,
      content,
      excerpt,
      author_id,
      published_at,
      status,
      featured_image_url,
      authors:author_id (
        id,
        username,
        display_name,
        bio
      )
    `).eq("status","published").order("published_at",{ascending:!1});if(e)throw new Error(`Failed to fetch posts: ${e.message}`);return s||[]})}function _e(s){return i(this,null,function*(){return(yield C()).find(r=>r.slug===s)||null})}function Ue(s=0,e=10,r=""){return i(this,null,function*(){const t=yield C();let a=t;if(r&&r.trim()){const c=r.toLowerCase();a=t.filter(u=>{var d,g;return u.title.toLowerCase().includes(c)||((d=u.excerpt)==null?void 0:d.toLowerCase().includes(c))||((g=u.content)==null?void 0:g.toLowerCase().includes(c))})}const o=s*e,n=o+e;return{posts:a.slice(o,n),hasMore:n<a.length,total:a.length}})}function j(){return i(this,null,function*(){if(f.authors||(f.authors=yield R("authors.json")),f.authors)return f.authors;const{data:s,error:e}=yield U.from("users").select("id, user_login, display_name, user_registered").order("display_name");if(e)throw new Error(`Failed to fetch authors: ${e.message}`);return s||[]})}function Re(s){return i(this,null,function*(){return(yield j()).find(r=>r.username===s)||null})}function Ie(s,e=""){return i(this,null,function*(){let t=(yield C()).filter(a=>a.author_id===s);if(e&&e.trim()){const a=e.toLowerCase();t=t.filter(o=>{var n,l;return o.title.toLowerCase().includes(a)||((n=o.excerpt)==null?void 0:n.toLowerCase().includes(a))||((l=o.content)==null?void 0:l.toLowerCase().includes(a))})}return t})}function z(){return i(this,null,function*(){if(f.categories||(f.categories=yield R("categories.json")),f.categories)return f.categories;const{data:s,error:e}=yield U.from("categories").select("id, name, slug, description").order("name");if(e)throw new Error(`Failed to fetch categories: ${e.message}`);return s||[]})}function ke(s){return i(this,null,function*(){return(yield z()).find(r=>r.slug===s)||null})}function Le(s,e=""){return i(this,null,function*(){let t=(yield C()).filter(a=>a.categories&&a.categories.some(o=>o.id===s));if(e&&e.trim()){const a=e.toLowerCase();t=t.filter(o=>{var n,l;return o.title.toLowerCase().includes(a)||((n=o.excerpt)==null?void 0:n.toLowerCase().includes(a))||((l=o.content)==null?void 0:l.toLowerCase().includes(a))})}return t})}function J(){return i(this,null,function*(){if(f.tags||(f.tags=yield R("tags.json")),f.tags)return f.tags;const{data:s,error:e}=yield U.from("tags").select("id, name, slug, description").order("name");if(e)throw new Error(`Failed to fetch tags: ${e.message}`);return s||[]})}function Fe(s){return i(this,null,function*(){return(yield J()).find(r=>r.slug===s)||null})}function Ne(s,e=""){return i(this,null,function*(){let t=(yield C()).filter(a=>a.tags&&a.tags.some(o=>o.id===s));if(e&&e.trim()){const a=e.toLowerCase();t=t.filter(o=>{var n,l;return o.title.toLowerCase().includes(a)||((n=o.excerpt)==null?void 0:n.toLowerCase().includes(a))||((l=o.content)==null?void 0:l.toLowerCase().includes(a))})}return t})}class M{constructor(e={}){this.config=e}upload(t){return i(this,arguments,function*(e,r={}){throw new Error("upload() method must be implemented by storage provider")})}delete(e){return i(this,null,function*(){throw new Error("delete() method must be implemented by storage provider")})}getPublicUrl(e){throw new Error("getPublicUrl() method must be implemented by storage provider")}list(){return i(this,arguments,function*(e={}){throw new Error("list() method must be implemented by storage provider")})}getMetadata(e){return i(this,null,function*(){throw new Error("getMetadata() method must be implemented by storage provider")})}isConfigured(){throw new Error("isConfigured() method must be implemented by storage provider")}getProviderName(){throw new Error("getProviderName() method must be implemented by storage provider")}validateFile(e,r={}){const t=[];if(!e)return t.push("No file provided"),{valid:!1,errors:t};e.type.startsWith("image/")||t.push("File must be an image");const a=r.maxSize||5*1024*1024;return e.size>a&&t.push(`File size must be less than ${Math.round(a/1024/1024)}MB`),{valid:t.length===0,errors:t}}generateUniqueFilename(e){const r=Date.now(),t=Math.random().toString(36).substring(2,8),a=e.split(".").pop(),o=e.split(".").slice(0,-1).join(".").toLowerCase().replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,20);return`${r}-${t}-${o}.${a}`}}class G extends M{constructor(e={}){super(e),this.bucketName=e.bucketName||"images"}upload(t){return i(this,arguments,function*(e,r={}){try{const a=this.validateFile(e,r);if(!a.valid)throw new Error(a.errors.join(", "));const o=this.generateUniqueFilename(e.name);r.onProgress&&r.onProgress(10);const{data:n,error:l}=yield h.storage.from(this.bucketName).upload(o,e,{contentType:e.type,upsert:!1});if(l)throw new Error(`Upload failed: ${l.message}`);r.onProgress&&r.onProgress(90);const{data:{publicUrl:c}}=h.storage.from(this.bucketName).getPublicUrl(o);return r.onProgress&&r.onProgress(100),{success:!0,url:c,filename:o,path:n.path,provider:"supabase"}}catch(a){return{success:!1,error:a.message,provider:"supabase"}}})}delete(e){return i(this,null,function*(){try{if(!e)throw new Error("No file identifier provided");let r=e;e.includes(`/storage/v1/object/public/${this.bucketName}/`)&&(r=e.split(`/${this.bucketName}/`).pop());const{error:t}=yield h.storage.from(this.bucketName).remove([r]);if(t)throw new Error(`Delete failed: ${t.message}`);return{success:!0,message:"Image deleted successfully",provider:"supabase"}}catch(r){return{success:!1,error:r.message,provider:"supabase"}}})}getPublicUrl(e){if(!e||e.startsWith("http"))return e;const r=e.startsWith("/")?e.slice(1):e,{data:{publicUrl:t}}=h.storage.from(this.bucketName).getPublicUrl(r);return t}list(){return i(this,arguments,function*(e={}){try{const{limit:r=100,offset:t=0}=e,{data:a,error:o}=yield h.storage.from(this.bucketName).list("",{limit:r,offset:t,sortBy:{column:"created_at",order:"desc"}});if(o)throw new Error(`Failed to list images: ${o.message}`);return{success:!0,files:a||[],provider:"supabase"}}catch(r){return{success:!1,error:r.message,files:[],provider:"supabase"}}})}getMetadata(e){return i(this,null,function*(){try{if(!e)throw new Error("No file identifier provided");let r=e;e.includes(`/storage/v1/object/public/${this.bucketName}/`)&&(r=e.split(`/${this.bucketName}/`).pop());const{data:t,error:a}=yield h.storage.from(this.bucketName).list("",{search:r});if(a)throw new Error(`Failed to get metadata: ${a.message}`);const o=t.find(n=>n.name===r);if(!o)throw new Error("Image not found");return{success:!0,metadata:o,provider:"supabase"}}catch(r){return{success:!1,error:r.message,metadata:null,provider:"supabase"}}})}isConfigured(){try{return!!("https://ktxhnxmdbfkswmkikgum.supabase.co"&&"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt0eGhueG1kYmZrc3dta2lrZ3VtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5NjE5OTksImV4cCI6MjA2OTUzNzk5OX0.5uWgEIlaGqHQupdBEsu76kzPDN3vzq4UFEknmKSpmHg")}catch(e){return!1}}getProviderName(){return"supabase"}}function K(s,e){return i(this,null,function*(){try{const r=yield fetch("/api/r2/presigned-upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:s,contentType:e})});if(!r.ok)throw new Error(`Failed to get presigned URL: ${r.statusText}`);return yield r.json()}catch(r){throw r}})}function Y(t,a){return i(this,arguments,function*(s,e,r={}){try{const{onProgress:o}=r;o&&o(20);const n=yield fetch(s,{method:"PUT",body:e,headers:{"Content-Type":e.type}});if(o&&o(90),!n.ok)throw new Error(`Upload failed: ${n.statusText}`);return o&&o(100),{success:!0,message:"Upload completed successfully"}}catch(o){return{success:!1,error:o.message}}})}function W(s){return i(this,null,function*(){try{const e=yield fetch("/api/r2/delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:s})});if(!e.ok)throw new Error(`Delete failed: ${e.statusText}`);return yield e.json()}catch(e){return{success:!1,error:e.message}}})}function Z(){return i(this,arguments,function*(s={}){try{const e=new URLSearchParams;s.limit&&e.set("limit",s.limit),s.offset&&e.set("offset",s.offset);const r=yield fetch(`/api/r2/list?${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`List failed: ${r.statusText}`);return yield r.json()}catch(e){return{success:!1,error:e.message,files:[]}}})}function X(s){return i(this,null,function*(){try{const e=yield fetch(`/api/r2/metadata?filename=${encodeURIComponent(s)}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Metadata request failed: ${e.statusText}`);return yield e.json()}catch(e){return{success:!1,error:e.message,metadata:null}}})}class H extends M{constructor(e={}){super(e),this.accountId=e.accountId||"ab54ca2d01df4886aa0c3f240ace806d",this.accessKeyId=e.accessKeyId||"399a86b7cc9968e58d9843168aa82f61",this.secretAccessKey=e.secretAccessKey||"d24937a919cbdcd3019d9228004d11306867c8e5bb3373e2ff37cf2b3356ecc6",this.bucketName=e.bucketName||"boopul",this.publicUrl=e.publicUrl||"https://pub-fc97d8e973a94b6ab42a5785e3a4130e.r2.dev",this.endpoint=e.endpoint||"https://ab54ca2d01df4886aa0c3f240ace806d.r2.cloudflarestorage.com"}upload(t){return i(this,arguments,function*(e,r={}){try{const a=this.validateFile(e,r);if(!a.valid)throw new Error(a.errors.join(", "));const o=this.generateUniqueFilename(e.name);r.onProgress&&r.onProgress(10);const n=yield K(o,e.type);if(!n.success)throw new Error(n.error||"Failed to get presigned URL");r.onProgress&&r.onProgress(30);const l=yield Y(n.url,e,{onProgress:u=>{const d=30+u*.7;r.onProgress&&r.onProgress(Math.round(d))}});if(!l.success)throw new Error(l.error||"Upload failed");return{success:!0,url:this.getPublicUrl(o),filename:o,path:o,provider:"cloudflare-r2"}}catch(a){return{success:!1,error:a.message,provider:"cloudflare-r2"}}})}delete(e){return i(this,null,function*(){try{if(!e)throw new Error("No file identifier provided");let r=e;e.includes(this.publicUrl)&&(r=e.replace(`${this.publicUrl}/`,""));const t=yield W(r);return{success:t.success,message:t.success?"Image deleted successfully":t.error,error:t.success?void 0:t.error,provider:"cloudflare-r2"}}catch(r){return{success:!1,error:r.message,provider:"cloudflare-r2"}}})}getPublicUrl(e){if(!e||e.startsWith("http"))return e;const r=e.startsWith("/")?e.slice(1):e;return`${this.publicUrl}/${r}`}list(){return i(this,arguments,function*(e={}){try{const r=yield Z(e);return{success:r.success,files:r.files||[],error:r.success?void 0:r.error,provider:"cloudflare-r2"}}catch(r){return{success:!1,error:r.message,files:[],provider:"cloudflare-r2"}}})}getMetadata(e){return i(this,null,function*(){try{if(!e)throw new Error("No file identifier provided");let r=e;e.includes(this.publicUrl)&&(r=e.replace(`${this.publicUrl}/`,""));const t=yield X(r);return{success:t.success,metadata:t.metadata,error:t.success?void 0:t.error,provider:"cloudflare-r2"}}catch(r){return{success:!1,error:r.message,metadata:null,provider:"cloudflare-r2"}}})}isConfigured(){return!!(this.accountId&&this.accessKeyId&&this.secretAccessKey&&this.bucketName&&this.publicUrl&&this.endpoint)}getProviderName(){return"cloudflare-r2"}}const Q={BASE_URL:"/",DEV:!0,MODE:"production",PROD:!1,SSG_MODE:"true",SSR:!1,VITE_CLOUDFLARE_ACCOUNT_ID:"ab54ca2d01df4886aa0c3f240ace806d",VITE_CLOUDFLARE_R2_ACCESS_KEY_ID:"399a86b7cc9968e58d9843168aa82f61",VITE_CLOUDFLARE_R2_BUCKET_NAME:"boopul",VITE_CLOUDFLARE_R2_ENDPOINT:"https://ab54ca2d01df4886aa0c3f240ace806d.r2.cloudflarestorage.com",VITE_CLOUDFLARE_R2_PUBLIC_URL:"https://pub-fc97d8e973a94b6ab42a5785e3a4130e.r2.dev",VITE_CLOUDFLARE_R2_SECRET_ACCESS_KEY:"d24937a919cbdcd3019d9228004d11306867c8e5bb3373e2ff37cf2b3356ecc6",VITE_STORAGE_PROVIDER:"cloudflare-r2",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt0eGhueG1kYmZrc3dta2lrZ3VtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5NjE5OTksImV4cCI6MjA2OTUzNzk5OX0.5uWgEIlaGqHQupdBEsu76kzPDN3vzq4UFEknmKSpmHg",VITE_SUPABASE_URL:"https://ktxhnxmdbfkswmkikgum.supabase.co",VITE_USER_NODE_ENV:"development"},_={SUPABASE:"supabase",CLOUDFLARE_R2:"cloudflare-r2"};class L{constructor(){this.providers=new Map,this.currentProvider=null,this.fallbackProvider=null,this.initializeProviders(),this.setCurrentProvider()}initializeProviders(){const e=new G({bucketName:"images"});this.providers.set(_.SUPABASE,e);const r=new H;this.providers.set(_.CLOUDFLARE_R2,r)}setCurrentProvider(){const e="cloudflare-r2";this.providers.has(e)?this.providers.get(e).isConfigured()?this.currentProvider=e:this.setFallbackProvider(e):this.setFallbackProvider(),this.currentProvider||(this.currentProvider=this.fallbackProvider,this.currentProvider)}setFallbackProvider(e=null){for(const[r,t]of this.providers)if(r!==e&&t.isConfigured()){this.fallbackProvider=r;break}}getCurrentProvider(){return this.currentProvider?this.providers.get(this.currentProvider):null}getProvider(e){return this.providers.get(e)||null}switchProvider(e){return!this.providers.has(e)||!this.providers.get(e).isConfigured()?!1:(this.currentProvider=e,!0)}getConfigurationStatus(){const e={current:this.currentProvider,fallback:this.fallbackProvider,providers:{}};for(const[r,t]of this.providers)e.providers[r]={configured:t.isConfigured(),name:t.getProviderName()};return e}validateConfiguration(){const e=[],r=[],t=Array.from(this.providers.entries()).filter(([a,o])=>o.isConfigured());if(t.length===0&&e.push("No storage providers are properly configured"),!this.currentProvider)e.push("No current storage provider is set");else{const a=this.getCurrentProvider();(!a||!a.isConfigured())&&e.push(`Current provider '${this.currentProvider}' is not properly configured`)}return!this.fallbackProvider&&t.length>1&&r.push("No fallback provider is available"),{valid:e.length===0,errors:e,warnings:r,configuredProviders:t.length,totalProviders:this.providers.size}}static getRequiredEnvironmentVariables(){return{[_.SUPABASE]:["VITE_SUPABASE_URL","VITE_SUPABASE_ANON_KEY"],[_.CLOUDFLARE_R2]:["VITE_CLOUDFLARE_ACCOUNT_ID","VITE_CLOUDFLARE_R2_ACCESS_KEY_ID","VITE_CLOUDFLARE_R2_SECRET_ACCESS_KEY","VITE_CLOUDFLARE_R2_BUCKET_NAME","VITE_CLOUDFLARE_R2_PUBLIC_URL","VITE_CLOUDFLARE_R2_ENDPOINT"],general:["VITE_STORAGE_PROVIDER"]}}static checkMissingEnvironmentVariables(){const e=L.getRequiredEnvironmentVariables(),r={};for(const[t,a]of Object.entries(e))r[t]=a.filter(o=>!Q[o]);return r}}const b=new L;function y(){return b.getCurrentProvider()}function ee(){return b.getConfigurationStatus()}function re(){return b.validateConfiguration()}function te(r){return i(this,arguments,function*(s,e={}){const t=y();if(!t)return{success:!1,error:"No storage provider is configured",provider:"none"};try{const a=yield t.upload(s,e);return a.provider||(a.provider=t.getProviderName()),a}catch(a){return{success:!1,error:a.message,provider:t.getProviderName()}}})}function se(s){return i(this,null,function*(){const e=y();if(!e)return{success:!1,error:"No storage provider is configured",provider:"none"};try{const r=yield e.delete(s);return r.provider||(r.provider=e.getProviderName()),r}catch(r){return{success:!1,error:r.message,provider:e.getProviderName()}}})}function ae(s){const e=y();if(!e)return s;try{return e.getPublicUrl(s)}catch(r){return s}}function oe(){return i(this,arguments,function*(s={}){const e=y();if(!e)return{success:!1,error:"No storage provider is configured",files:[],provider:"none"};try{const r=yield e.list(s);return r.provider||(r.provider=e.getProviderName()),r}catch(r){return{success:!1,error:r.message,files:[],provider:e.getProviderName()}}})}function ie(s){return i(this,null,function*(){const e=y();if(!e)return{success:!1,error:"No storage provider is configured",metadata:null,provider:"none"};try{const r=yield e.getMetadata(s);return r.provider||(r.provider=e.getProviderName()),r}catch(r){return{success:!1,error:r.message,metadata:null,provider:e.getProviderName()}}})}function Oe(){const s=y();return s?s.getProviderName():null}function ne(){return ee()}function ce(){return re()}const $e=(r,...t)=>i(null,[r,...t],function*(s,e={}){const{maxWidth:a=1200,maxHeight:o=800,quality:n=.8,format:l="image/jpeg"}=e;return new Promise((c,u)=>{const d=document.createElement("canvas"),g=d.getContext("2d"),p=new Image;p.onload=()=>{let{width:m,height:v}=p;m>a&&(v=v*a/m,m=a),v>o&&(m=m*o/v,v=o),d.width=m,d.height=v,g.drawImage(p,0,0,m,v),d.toBlob(E=>{if(E){const P=new File([E],s.name,{type:l,lastModified:Date.now()});c(P)}else u(new Error("Failed to compress image"))},l,n)},p.onerror=()=>{u(new Error("Failed to load image"))},p.src=URL.createObjectURL(s)})}),le={अ:"a",आ:"aa",इ:"i",ई:"ii",उ:"u",ऊ:"uu",ए:"e",ऐ:"ai",ओ:"o",औ:"au",क:"ka",ख:"kha",ग:"ga",घ:"gha",ङ:"nga",च:"cha",छ:"chha",ज:"ja",झ:"jha",ञ:"nya",ट:"ta",ठ:"tha",ड:"da",ढ:"dha",ण:"na",त:"ta",थ:"tha",द:"da",ध:"dha",न:"na",प:"pa",फ:"pha",ब:"ba",भ:"bha",म:"ma",य:"ya",र:"ra",ल:"la",व:"va",श:"sha",ष:"sha",स:"sa",ह:"ha",क्ष:"ksha",त्र:"tra",ज्ञ:"gya","ं":"n","ः":"h","्":"","ा":"aa","ि":"i","ी":"ii","ु":"u","ू":"uu","े":"e","ै":"ai","ो":"o","ौ":"au"},ue=s=>{if(!s)return"";let e=s;return Object.entries(le).forEach(([r,t])=>{const a=new RegExp(r,"g");e=e.replace(a,t)}),e},Me=s=>{if(!s)return"";const e=ue(s),r=q(e,{lower:!0,strict:!0,remove:/[*+~.()'"!:@]/g});return r?r.substring(0,100):`post-${Date.now()}`},de=(s,e=null)=>i(null,null,function*(){if(!s)return!1;try{let r=h.from("posts").select("id").eq("slug",s);e&&(r=r.neq("id",e));const{data:t,error:a}=yield r;return a?!1:!t||t.length===0}catch(r){return!1}}),A=(s,e=null)=>i(null,null,function*(){let r=s,t=1;for(;!(yield de(r,e));)if(r=`${s}-${t}`,t++,t>100){r=`${s}-${Date.now()}`;break}return r}),D=s=>s?s.length<3?{isValid:!1,message:"Slug must be at least 3 characters long"}:s.length>100?{isValid:!1,message:"Slug must be less than 100 characters"}:/^[a-z0-9-]+$/.test(s)?s.startsWith("-")||s.endsWith("-")?{isValid:!1,message:"Slug cannot start or end with a hyphen"}:s.includes("--")?{isValid:!1,message:"Slug cannot contain consecutive hyphens"}:["admin","api","www","mail","ftp","localhost","test","staging","dev","development","prod","production","blog","post","page","category","tag","author","search"].includes(s)?{isValid:!1,message:"This slug is reserved and cannot be used"}:{isValid:!0,message:""}:{isValid:!1,message:"Slug can only contain lowercase letters, numbers, and hyphens"}:{isValid:!1,message:"Slug is required"},Ae=s=>i(null,null,function*(){try{if(!s.title)throw new Error("Title is required");const e=D(s.slug);if(!e.isValid)throw new Error(e.message);const r=yield A(s.slug),{data:{user:t}}=yield h.auth.getUser();if(!t)throw new Error("You must be logged in to create posts");const a={title:s.title.trim(),slug:r,content:s.content||"",excerpt:s.excerpt||"",status:s.status||"draft",featured_image_url:s.featured_image_url||null,meta_title:s.meta_title||null,meta_description:s.meta_description||null,author_id:t.id,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};a.status==="published"&&(a.published_at=s.published_at||new Date().toISOString());const{data:o,error:n}=yield h.from("posts").insert([a]).select().single();if(n)throw new Error(`Failed to create post: ${n.message}`);return o}catch(e){throw e}}),De=(s,e)=>i(null,null,function*(){try{if(!s)throw new Error("Post ID is required");if(!e.title)throw new Error("Title is required");if(e.slug){const o=D(e.slug);if(!o.isValid)throw new Error(o.message);const n=yield A(e.slug,s);e.slug=n}const r={title:e.title.trim(),content:e.content||"",excerpt:e.excerpt||"",status:e.status||"draft",featured_image_url:e.featured_image_url||null,meta_title:e.meta_title||null,meta_description:e.meta_description||null,updated_at:new Date().toISOString()};if(e.slug&&(r.slug=e.slug),r.status==="published"&&e.published_at)r.published_at=e.published_at;else if(r.status==="published"){const{data:o}=yield h.from("posts").select("published_at").eq("id",s).single();o!=null&&o.published_at||(r.published_at=new Date().toISOString())}const{data:t,error:a}=yield h.from("posts").update(r).eq("id",s).select().single();if(a)throw new Error(`Failed to update post: ${a.message}`);return t}catch(r){throw r}}),Ve=s=>i(null,null,function*(){try{if(!s)throw new Error("Post ID is required");const{error:e}=yield h.from("posts").delete().eq("id",s);if(e)throw new Error(`Failed to delete post: ${e.message}`);return!0}catch(e){throw e}}),xe=(...e)=>i(null,[...e],function*(s={}){try{const{page:r=0,limit:t=10,status:a=null,search:o="",orderBy:n="updated_at",orderDirection:l="desc"}=s;let c=h.from("posts").select("id, title, slug, status, published_at, created_at, updated_at",{count:"exact"});a&&a!=="all"&&(c=c.eq("status",a)),o&&o.trim()&&(c=c.ilike("title",`%${o.trim()}%`)),c=c.order(n,{ascending:l==="asc"});const u=r*t,d=u+t-1;c=c.range(u,d);const{data:g,error:p,count:m}=yield c;if(p)throw new Error(`Failed to fetch posts: ${p.message}`);return{posts:g||[],total:m||0,page:r,limit:t,hasMore:g&&g.length===t}}catch(r){throw r}}),qe=(s,e)=>i(null,null,function*(){try{if(!s||s.length===0)throw new Error("Post IDs are required");if(!["draft","published","private"].includes(e))throw new Error("Invalid status");const r={status:e,updated_at:new Date().toISOString()};e==="published"&&(r.published_at=new Date().toISOString());const{data:t,error:a}=yield h.from("posts").update(r).in("id",s).select("id");if(a)throw new Error(`Failed to update posts: ${a.message}`);return t?t.length:0}catch(r){throw r}});class ge{constructor(){this.testResults=[]}runValidationTests(){return i(this,arguments,function*(e={}){const{includeUploadTest:r=!1,testImageUrl:t=null}=e;this.testResults=[];let a=0,o=0;o++;const n=yield this.testConfiguration();n.passed&&a++,this.testResults.push(n),o++;const l=yield this.testProviderAvailability();l.passed&&a++,this.testResults.push(l),o++;const c=yield this.testUrlGeneration();c.passed&&a++,this.testResults.push(c),o++;const u=yield this.testListFunctionality();if(u.passed&&a++,this.testResults.push(u),t){o++;const g=yield this.testMetadataFunctionality(t);g.passed&&a++,this.testResults.push(g)}if(r){o++;const g=yield this.testUploadDeleteFunctionality();g.passed&&a++,this.testResults.push(g)}return{success:a===o,passedTests:a,totalTests:o,passRate:Math.round(a/o*100),results:this.testResults,timestamp:new Date().toISOString()}})}testConfiguration(){return i(this,null,function*(){try{const e=ne(),r=ce(),t=r.valid&&e.current!==null;return{name:"Configuration Test",passed:t,details:{currentProvider:e.current,configuredProviders:Object.keys(e.providers).filter(a=>e.providers[a].configured),validationErrors:r.errors,validationWarnings:r.warnings},message:t?"Storage configuration is valid":"Storage configuration has issues"}}catch(e){return{name:"Configuration Test",passed:!1,error:e.message,message:"Configuration test failed"}}})}testProviderAvailability(){return i(this,null,function*(){try{const e=y(),r=e!==null&&e.isConfigured();return{name:"Provider Availability Test",passed:r,details:{providerName:e?e.getProviderName():"none",isConfigured:e?e.isConfigured():!1},message:r?"Storage provider is available and configured":"Storage provider is not available"}}catch(e){return{name:"Provider Availability Test",passed:!1,error:e.message,message:"Provider availability test failed"}}})}testUrlGeneration(){return i(this,null,function*(){try{const e="test-image.jpg",r=ae(e),t=typeof r=="string"&&r.length>0&&r!==e;return{name:"URL Generation Test",passed:t,details:{testFilename:e,generatedUrl:r,urlLength:r?r.length:0},message:t?"URL generation works correctly":"URL generation failed"}}catch(e){return{name:"URL Generation Test",passed:!1,error:e.message,message:"URL generation test failed"}}})}testListFunctionality(){return i(this,null,function*(){try{const e=yield oe({limit:5}),r=e.success&&Array.isArray(e.files);return{name:"List Functionality Test",passed:r,details:{success:e.success,fileCount:e.files?e.files.length:0,error:e.error},message:r?"List functionality works correctly":"List functionality failed"}}catch(e){return{name:"List Functionality Test",passed:!1,error:e.message,message:"List functionality test failed"}}})}testMetadataFunctionality(e){return i(this,null,function*(){try{const r=yield ie(e),t=r.success&&r.metadata!==null;return{name:"Metadata Functionality Test",passed:t,details:{testImageUrl:e,success:r.success,hasMetadata:r.metadata!==null,error:r.error},message:t?"Metadata functionality works correctly":"Metadata functionality failed"}}catch(r){return{name:"Metadata Functionality Test",passed:!1,error:r.message,message:"Metadata functionality test failed"}}})}testUploadDeleteFunctionality(){return i(this,null,function*(){try{const e=this.createTestImageBlob(),r=new File([e],"storage-test.png",{type:"image/png"}),t=yield te(r);if(!t.success)return{name:"Upload/Delete Functionality Test",passed:!1,details:{uploadError:t.error,phase:"upload"},message:"Upload test failed"};const a=yield se(t.filename||t.url),o=t.success&&a.success;return{name:"Upload/Delete Functionality Test",passed:o,details:{uploadSuccess:t.success,deleteSuccess:a.success,uploadedUrl:t.url,uploadError:t.error,deleteError:a.error},message:o?"Upload/Delete functionality works correctly":"Upload/Delete functionality failed"}}catch(e){return{name:"Upload/Delete Functionality Test",passed:!1,error:e.message,message:"Upload/Delete functionality test failed"}}})}createTestImageBlob(){const e=document.createElement("canvas");e.width=1,e.height=1;const r=e.getContext("2d");return r.fillStyle="#FF0000",r.fillRect(0,0,1,1),new Promise(t=>{e.toBlob(t,"image/png")})}getTestResults(){return this.testResults}exportTestResults(){return JSON.stringify({timestamp:new Date().toISOString(),results:this.testResults},null,2)}}const me=new ge;function Be(){return i(this,arguments,function*(s={}){return yield me.runValidationTests(s)})}class fe{constructor(){this.migrationLog=[]}migrateImages(a,o){return i(this,arguments,function*(e,r,t={}){const{batchSize:n=10,onProgress:l=null,dryRun:c=!1,filter:u=null}=t;try{const d=b.getProvider(e),g=b.getProvider(r);if(!d||!g)throw new Error("Invalid provider specified");if(!d.isConfigured()||!g.isConfigured())throw new Error("Both providers must be properly configured");const p=yield d.list({limit:1e3});if(!p.success)throw new Error(`Failed to list images from ${e}: ${p.error}`);let m=p.files||[];u&&typeof u=="function"&&(m=m.filter(u));const v=m.length;let E=0,P=0;const F=[];for(let S=0;S<m.length;S+=n){const I=m.slice(S,S+n);(yield Promise.allSettled(I.map(w=>this.migrateImage(w,d,g,{dryRun:c})))).forEach((w,x)=>{const k=I[x];if(w.status==="fulfilled"&&w.value.success)E++,this.migrationLog.push({type:"success",image:k.name,timestamp:new Date().toISOString(),dryRun:c});else{P++;const T=w.status==="rejected"?w.reason:w.value.error;F.push({image:k.name,error:T.message||T}),this.migrationLog.push({type:"error",image:k.name,error:T.message||T,timestamp:new Date().toISOString(),dryRun:c})}});const V=Math.round((S+I.length)/v*100);l&&l({total:v,migrated:E,errors:P,progress:V})}return{success:!0,totalImages:v,migratedCount:E,errorCount:P,errors:F,dryRun:c,log:this.migrationLog}}catch(d){return{success:!1,error:d.message,totalImages:0,migratedCount:0,errorCount:0,errors:[],dryRun:c,log:this.migrationLog}}})}migrateImage(o,n,l){return i(this,arguments,function*(e,r,t,a={}){const{dryRun:c=!1}=a;try{if(c)return{success:!0,message:`Would migrate ${e.name}`,dryRun:!0};const u=r.getPublicUrl(e.name),d=yield fetch(u);if(!d.ok)throw new Error(`Failed to download image: ${d.statusText}`);const g=yield d.blob(),p=new File([g],e.name,{type:g.type}),m=yield t.upload(p,{filename:e.name});if(!m.success)throw new Error(m.error||"Upload failed");return{success:!0,sourceUrl:u,targetUrl:m.url,filename:e.name}}catch(u){return{success:!1,error:u.message,filename:e.name}}})}verifyMigration(e,r,t){return i(this,null,function*(){const a=b.getProvider(e),o=b.getProvider(r);if(!a||!o)throw new Error("Invalid provider specified");const n=[];let l=0,c=0;for(const u of t)try{const d=yield o.getMetadata(u.filename);d.success?(l++,n.push({filename:u.filename,status:"verified",targetExists:!0})):(c++,n.push({filename:u.filename,status:"missing",targetExists:!1,error:d.error}))}catch(d){c++,n.push({filename:u.filename,status:"error",error:d.message})}return{success:c===0,totalChecked:t.length,successCount:l,errorCount:c,results:n}})}getMigrationLog(){return this.migrationLog}clearMigrationLog(){this.migrationLog=[]}exportMigrationLog(){return JSON.stringify({timestamp:new Date().toISOString(),log:this.migrationLog},null,2)}}const pe=new fe;function je(t,a){return i(this,arguments,function*(s,e,r={}){return yield pe.migrateImages(s,e,r)})}export{C as A,Fe as B,Ne as C,Te as D,xe as E,je as F,Ee as a,ye as b,$e as c,Se as d,Me as e,Pe as f,Oe as g,De as h,Ae as i,qe as j,Ve as k,ne as l,ce as m,Ce as n,b as o,Be as p,Re as q,Ie as r,h as s,j as t,te as u,de as v,ke as w,Le as x,Ue as y,_e as z};
